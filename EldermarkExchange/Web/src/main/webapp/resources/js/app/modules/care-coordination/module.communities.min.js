ExchangeApp.modules.CareCoordinationCommunities=function(){var e,n,t={},a={template:"care-coordination/templates/communities"},i="care-coordination/communities/isUnique",o="communitiesTabContent",r={reloadNeeded:!1},l=ExchangeApp.routers.ModuleRouter,c=ExchangeApp.utils.module,s=ExchangeApp.utils.wgt,d=ExchangeApp.loaders.FragmentLoader.init("careCoordinationCommunities"),m=Object.freeze({ADD:"create",EDIT:"edit"}),u=(new Map,null);function f(){p().random=c.rand(),function(e,n){var t=p(),a=e||t.$html,i=n||t.random;a=c.randomize(a,i,!1)}(),function(e,n){var t=p();t.ajaxMap||(t.ajaxMap={});var a=e||t.$html,i=n||t.random,o=c.findAjaxUrls(a,i);$.each(o,function(e,n){t.ajaxMap[v(n,{params:!0})]=n}),c.find(a,i,'[data-ajax-load="true"]').on("click",function(){var e=$(this).attr("data-ajax-url-tmpl"),n=$(this).attr("data-ajax-url-vars"),t=$(this).attr("data-ajax-url-params"),a=c.getUrl(e,n,t);return l.route(a),!1}),c.find(a,i,'[data-ajax-anchor="true"]').on("click",function(){var e=$($(this).attr("href"));return e.length&&$("html, body").animate({scrollTop:e.offset().top},200),!1})}()}function p(){return t[v(a,{params:!0})]}function h(){return $('[id^="'+o+'"]')}function v(e,n){return c.stringifyUrl(e,n)}function g(e){var n=p();return c.find(n.$html,n.random,e)}function y(e){var n=e.find("#careTeamEmployeeSelect").val(),t=e.find("#careTeamRoleSelect").val(),a=e.find("#careTeamMemberId").val();if(t){var i="care-coordination/communities/community/"+$("#currentCommunityId").val()+"/care-team/notification-preferences?careTeamRoleId="+t;n&&(i+="&employeeId="+n),a&&(i+="&careTeamMemberId="+a),$.ajax(i).success(function(n){!function(e,n){var t=e.find("#careTeamMemberNotificationPreferences");t.empty();var a=e.find("#notificationPreferencesTemplate").clone();a.attr("id","notificationPreferencesTemplate-all"),a.find(".eventType").html("All Events").css("font-style","italic");var i=a.find(".responsibility");i.append("<option selected disabled hidden style='display: none' value=''></option>"),i.select2({minimumResultsForSearch:1/0,width:"100%"}),i.on("change",function(e){t.find(".responsibility:enabled").not(this).val($(this).val()).trigger("change")});var o=a.find(".notificationType");o.selectpicker(),o.on("changed.bs.select",c.allOptionHandler),o.on("change",function(e){var n=t.find(".notificationType").not(this);n.not(".notesNotificationType").selectpicker("val",$(this).val());var a=null;$(this).val()?$(this).val().find(function(e){return"ALL"===e})?(a=[],$(this).children("option").each(function(e,n){a.push(n.value)})):a=$(this).val():(i.select2("val","N"),i.trigger("change")),n.find(".notesNotificationType").selectpicker("val",a),t.find(".notes-dropdown-menu")}),a.removeClass("hidden"),t.append(a);var r=0;$.each(n,function(n,a){$.each(a.notificationPreferences,function(n,i){var o=e.find("#notificationPreferencesTemplate").clone();o.attr("id","notificationPreferencesTemplate-"+r),o.find(".eventType").html(i.eventType);var l=o.find(".notificationPreferencesId");l.val(i.id),l.attr("name","notificationPreferences["+r+"].id");var s=o.find(".eventTypeId");s.val(i.eventTypeId),s.attr("name","notificationPreferences["+r+"].eventTypeId");var d=o.find(".responsibility");d.attr("name","notificationPreferences["+r+"].responsibility"),"COVID-19"===i.eventType&&(d.find("option[value='V']").prop("disabled",!0),d.find("option[value='N']").prop("disabled",!0)),d.select2({minimumResultsForSearch:1/0,width:"100%"}),d.select2("val",i.responsibility);var m=o.find(".notificationType");m.attr("name","notificationPreferences["+r+"].notificationTypeList"),m.attr("id","notificationPreferences-"+r),m.selectpicker(),i.notificationTypeList&&("Notes"===a.name&&(i.notificationTypeList=i.notificationTypeList),m.selectpicker("val",i.notificationTypeList)),"Notes"===a.name&&(m.addClass("notesNotificationType"),o.find(".notificationType > .dropdown-menu").addClass("notes-dropdown-menu")),m.on("changed.bs.select",c.allOptionHandler),m.on("change",function(e){!e.currentTarget.selectedOptions.length&&d.is(":enabled")&&d.select2("val","N")}),i.canChange||d.prop("disabled",!0),d.on("change",function(){"N"===$(this).val()&&m.selectpicker("val",[])}),o.removeClass("hidden"),0==n?t.append('<div class="sectionHead notificationPreferenceHead">'+a.name+"</div>"):n==a.notificationPreferences.length-1&&o.css("height","52px"),t.append(o),r++})})}(e,n)})}}function C(e,n,t,a,i,o,r){$.ajax("care-coordination/communities/community/"+$("#currentCommunityId").val()+"/care-team/"+(n?n+"/":"")+o+"/"+r).success(function(r){e.empty(),e.append(r),function(e){e.find("#careTeamMemberForm").validate(new ExchangeApp.utils.wgt.Validation({rules:{careTeamEmployeeSelect:{required:!0},careTeamRoleSelect:{required:!0}},messages:{careTeamEmployeeSelect:{required:getErrorMessage("field.empty")},careTeamRoleSelect:{required:getErrorMessage("field.empty")}}}))}(e);var l=e.find("#createCareTeamMemberModal"),s=(n?"Edit":"Create")+" Community Care Team Member";e.find("#careTeamMemberHeader").html(s),$(e.find("#careTeamMemberId")).val(n),$(e.find("#careTeamDescription")).val(t);var d=e.find("#careTeamEmployeeSelect");d.select2({placeholder:"Select Contact",width:"100%"}),d.on("change",function(n){y(e)}),a&&(d.val(a.id).trigger("change"),d.attr("disabled",!0));var m=e.find("#careTeamRoleSelect");m.select2({placeholder:"Select Role",width:"100%"}),m.on("change",function(n){y(e)}),i&&m.val(i.id).trigger("change");var u=e.find(".modal-content"),f=e.find(".modal-body"),h=c.initAjaxLoader(u,{loaderWillBeShown:function(){f.css("visibility","hidden")},loaderWillBeHidden:function(){f.css("visibility","visible")}});e.find("#saveCareTeamMember").on("click",function(){!function(e,n,t,a,i){if(!a.hasClass("pending")){a.addClass("pending");var o=e.find("#careTeamMemberForm"),r=form2js("careTeamMemberForm",".",!0,function(e){if(e.id&&e.id.match(/callbackTest/))return{name:e.id,value:e.innerHTML}});!!o.valid()&&(delete r._csrf,delete r._,i.show(),$.ajax({url:"care-coordination/communities/community/"+$("#currentCommunityId").val()+"/care-team/",type:"PUT",contentType:"application/json; charset=utf-8",data:JSON.stringify(r),beforeSend:function(e){c.csrf(e)}}).success(function(e){t?(p().widgets.affiliatedCommunityCareTeam.api().ajax.reload(),$("#copySettings").hide()):p().widgets.communityCareTeam.api().ajax.reload(),n.modal("hide"),i.hide(),a.removeClass("pending")}).fail(function(e){i.hide(),c.onAjaxError(e,function(){a.removeClass("pending"),$("#formError").text(e.responseText)})}))}}(e,l,o,$(this),h)}),e.find("#careTeamMemberForm input").keydown(function(e){if(13===e.which)return e.preventDefault(),!1}),e.find("#createCareTeamMemberModal").find(".cancelBtn").on("click",function(){l.modal("hide")}),e.find("#createCareTeamMemberModal").modal("show"),e.find("#createCareTeamMemberModal").on("hidden.bs.modal",function(){$(this).remove()}),n&&y(e)}).fail(function(){alert("Internal server error. Please contact administrator.")})}function b(e){var n=s.grid(p().$html,"",{tableId:e?"affiliatedCommunityCareTeam":"communityCareTeam",totalDisplayRows:25,colSettings:{description:{bSortable:!1},actions:{width:"100px",className:"dt-head-center"}},callbacks:{rowCallback:function(n,t,a){var i=$(n);if(t&&("true"!=$("#affiliatedView").val()||e)){if(i.children("td:eq(3)").empty(),t.editable||t.deletable||t.nucleusUserId){var o=c.find(p().$html,"","#rowActions").clone(),r="rowActions-"+a;o.attr("id",r),o.removeClass("hidden"),i.children("td:eq(3)").append(o)}var l=t.id,s=t.employee,d=t.role,m=t.description,u=t.roleEditable,f=c.find(p().$html,"","#createCareTeamContainer"),h=c.find(p().$html,"","#deleteCareTeamContainer");t.editable&&(o.find(".editCareTeamMember").removeClass("hidden"),o.find(".editCareTeamMember").on("click",function(){C(f,l,m,s,d,e,u)}),t.deletable||o.css("padding-right","60px")),t.deletable&&(o.find(".deleteCareTeamMember").removeClass("hidden"),o.find(".deleteCareTeamMember").on("click",function(){!function(e,n,t,a,i){$.ajax("care-coordination/communities/community/"+$("#currentCommunityId").val()+"/care-team/"+n+"/delete").success(function(a){e.empty(),e.append(a);var o=n;e.find("#careTeamMemberName").html("<b>"+t+"</b>"),e.find("#deleteCareTeamMember").on("click",function(){function n(){i?(p().widgets.affiliatedCommunityCareTeam.api().ajax.reload(),$("#copySettings").length>0&&$.ajax("care-coordination/communities/community/"+$("#currentCommunityId").val()+"/show-copy-settings/").success(function(e){e&&$("#copySettings").show()})):p().widgets.communityCareTeam.api().ajax.reload(),e.find("#deleteCareTeamMemberModal").modal("hide")}return $.ajax({url:"care-coordination/communities/community/"+$("#currentCommunityId").val()+"/care-team/"+o,type:"DELETE",beforeSend:function(e){c.csrf(e)}}).fail(function(e){c.onAjaxError(e,function(){alert(e.responseText)})}).complete(function(){"true"!=$("#isCCAdmin").val()?$.ajax({type:"GET",contentType:"json",url:"care-coordination/communities/community/"+$("#currentCommunityId").val()+"/has-view-access",success:function(t){1!=t?(e.find("#deleteCareTeamMemberModal").modal("hide"),g("#communityDetailsContent").hide(),g("#communitiesContent").show(),p().widgets.communitiesList.api().ajax.reload(),ExchangeApp.managers.EventManager.publish("community_list_changed")):n()}}):n()}),!1}),e.find(".cancelBtn").on("click",function(){e.find("#deleteCareTeamMemberModal").modal("hide")}),e.find("#deleteCareTeamMemberModal").modal("show"),e.find("#deleteCareTeamMemberModal").on("hidden.bs.modal",function(){$(this).remove()})})}(h,l,s.label,s.id,e)})),t.nucleusUserId&&(o.find(".videoCallCareTeamMember").removeClass("hidden"),o.find(".videoCallCareTeamMember").on("click",function(){initCall()&&startCall(t.nucleusUserId)}))}},errorCallback:function(e){alert(e.responseText)},footerCallback:function(e,n,t,a,i){$(e).hide()}}});e?p().widgets.affiliatedCommunityCareTeam=n:p().widgets.communityCareTeam=n}function k(e,t,a){$.ajax("care-coordination/communities/community/"+e+"/details").success(t,function(t){if(!g("#communitiesContent").is(":hidden")||!g("#communityDetailsContent").is(":hidden")){g("#communitiesContent").hide(),g("#communityDetailsContent").hide(),g("#communityDetailsContent").empty(),g("#communityDetailsContent").append(t),g("#communityDetailsContent").show(),c.find(p().$html,"",".backToCommunityList").on("click",function(){n!=ExchangeApp.modules.Header.getCurrentOrganizationFilter()?ExchangeApp.modules.CareCoordination.routeToCommunityList():(g("#communityDetailsContent").hide(),g("#communitiesContent").show())});var i=c.find(p().$html,"","#createCareTeamContainer");if(c.find(p().$html,"","#createCareTeamMember").on("click",function(){C(i,null,null,null,null,!1,!0)}),c.find(p().$html,"","#createAffiliatedCareTeamMember").on("click",function(){C(i,null,null,null,null,!0,!0)}),c.find(p().$html,"","#editCommunity").on("click",function(){E(g("#createCommunityContainer"),e,$(this),m.EDIT)}),c.find(p().$html,"","#copySettings").on("click",function(){!function(e,n){$.ajax("care-coordination/communities/community/"+n+"/copy-settings").success(function(t){e.empty(),e.append(t);var a=e.find("#copySettingsModal");e.find("#copySettingsBtn").on("click",function(){return $.ajax("care-coordination/communities/community/"+n+"/copy-settings/"+a.find("#copySettingsCommunitySelect").val()).success(function(e){p().widgets.affiliatedCommunityCareTeam.api().ajax.reload(),a.modal("hide"),$("#copySettings").hide()}).fail(function(e){console.log(e),alert(e.responseText)}),!1}),a.modal("show"),a.on("hidden.bs.modal",function(){$(this).remove()})}).fail(function(e,n){console.log(e,n),alert("Internal server error. Please contact administrator.")})}(i,e)}),b(!1),b(!0),a&&$("#newlyCreatedAlert").show(),!ExchangeApp.modules.CareCoordinationOrganizations&&"true"==$("#isCCSuperAdmin").val()){ExchangeApp.managers.ModuleManager.invoke({module:{name:"CareCoordinationOrganizations",fragment:{url:{template:"care-coordination/templates/organizations"}}},initParents:!1,forceReload:void 0,asyncLoad:!0})}$("a[id^=initialCommunityDetailsLink],a[id^=affiliatedCommunityDetailsLink]").each(function(e){var n=$(this).children("input").first().val(),t=$(this).children("input").last().val();$(this).click(function(){ExchangeApp.modules.Header.setCurrentOrg(t),ExchangeApp.modules.Header.showCurrentOrg(),k(n,void 0,!1)})}),$("a[id^=initialDatabaseDetailsLink],a[id^=affiliatedDatabaseDetailsLink]").each(function(e){var n=$(this).children("input").first().val();$(this).click(function(){ExchangeApp.modules.Header.setCurrentOrg(n),ExchangeApp.modules.Header.hideCurrentOrg(),ExchangeApp.modules.CareCoordinationCommunities.hide(),ExchangeApp.modules.CareCoordinationOrganizations.show(),ExchangeApp.modules.CareCoordinationOrganizations.showOrgDetails(n)})})}})}function T(){var e,t;p().widgets.communitiesList=(e={tableId:"communitiesList",searchFormId:"communityFilterForm",totalDisplayRows:25,colSettings:{createdAutomatically:{customRender:function(e){return e?"Yes":""}}},callbacks:{rowCallback:function(e,n,t){var a=$(e),i=n.id;a.attr("style","cursor:pointer"),a.on("click",function(){k(i,n,!1)})},errorCallback:function(e){alert(e.responseText)},footerCallback:function(e,n,t,a,i){$(e).hide()}}},t=p(),s.grid(t.$html,t.random,e)),p().widgets.communitiesList.api().ajax.reload(),n=ExchangeApp.modules.Header.getCurrentOrganizationFilter()}function x(e){return e.find("#commConfirmVisibilityInMarketplace").is(":checked")}function w(e){return e.find("#allowAppointments").is(":checked")}function I(e){var n=0,t=0,a=$(e).find("option")[0],i=$(a).parent().prev();$(e);$(i).find("ul").children().filter(function(e,a){"None"!=a.outerText&&"All"!=a.outerText&&0!=a.outerText.length||t++,"selected"===$(a).attr("class")&&n++});var o=$(i).find("ul").children().length-t;if(n===o){var r=$(i).prev().find("span")[0];$(r).text("All"),$(e).val(0),$(i).find("ul").children().filter(function(e,n){$(n).removeClass("selected"),"All"==n.outerText&&$(n).addClass("selected")})}}function A(e){var n=e.selectpicker("val")||[],t=e.find("option");if(n.indexOf("0")>-1)return $.map(t,function(e){if("none"!==e.text.toLowerCase())return e.value}).filter(function(e){return e>0});var a=$.map(t,function(e){if("none"===e.text.toLowerCase())return e.value});return n.indexOf(a[0])>-1?$.map(t,function(e){if("none"===e.text.toLowerCase())return e.value}).filter(function(e){return e>0}):n}function S(e){var n;return e.marketplace={},e.marketplace.confirmVisibility=e["marketplace.confirmVisibility"],e.marketplace.servicesSummaryDescription=e["marketplace.servicesSummaryDescription"],e.marketplace.prerequisite=e["marketplace.prerequisite"],e.marketplace.exclusion=e["marketplace.exclusion"],e.marketplace.allowAppointments=e["marketplace.allowAppointments"],e.marketplace.appointmentsEmail=e["marketplace.appointmentsEmail"],e.marketplace.appointmentsSecureEmail=e["marketplace.appointmentsSecureEmail"],e.marketplace.allInsurancesAccepted=e["marketplace.allInsurancesAccepted"],e.marketplace.primaryFocusIds=A($("#commPrimaryFocus")),e.marketplace.communityTypeIds=A($("#commCommunityType")),e.marketplace.levelOfCareIds=A($("#commLevelsOfCare")),e.marketplace.ageGroupIds=A($("#commAgeGroupsAccepted")),e.marketplace.serviceTreatmentApproachIds=A($("#commServicesTreatmentApproaches")),e.marketplace.emergencyServiceIds=A($("#commEmergencyServices")),e.marketplace.languageServiceIds=A($("#commLanguageServices")),e.marketplace.ancillaryServiceIds=A($("#commAncillaryServices")),e.marketplace.selectedInNetworkInsurancePlanIds=(n={},$("#in-network-insurance-table").find("tr").each(function(){var e=$(this);if(e.attr("role")){var t=e.data("network-id");if(t){var a=e.find("select.selected-plan");n[t]=a.size()?A(a):[]}}}),n),delete e["marketplace.confirmVisibility"],delete e["marketplace.servicesSummaryDescription"],delete e["marketplace.prerequisite"],delete e["marketplace.exclusion"],delete e["marketplace.allowAppointments"],delete e["marketplace.appointmentsEmail"],delete e["marketplace.appointmentsSecureEmail"],delete e["marketplace.primaryFocusIds"],delete e["marketplace.communityTypeIds"],delete e["marketplace.levelOfCareIds"],delete e["marketplace.ageGroupIds"],delete e["marketplace.serviceTreatmentApproachIds"],delete e["marketplace.emergencyServiceIds"],delete e["marketplace.languageServiceIds"],delete e["marketplace.ancillaryServiceIds"],delete e["marketplace.selectedInNetworkInsuranceIds"],delete e["marketplace.selectedInNetworkInsurancePlanIds"],delete e["marketplace.acceptedInsurancePlanIds"],delete e["marketplace.allInsurancesAccepted"],delete e["_marketplace.confirmVisibility"],delete e["_marketplace.allowAppointments"],delete e["_marketplace.primaryFocusIds"],delete e["_marketplace.communityTypeIds"],delete e["_marketplace.levelOfCareIds"],delete e["_marketplace.ageGroupIds"],delete e["_marketplace.serviceTreatmentApproachIds"],delete e["_marketplace.emergencyServiceIds"],delete e["_marketplace.languageServiceIds"],delete e["_marketplace.ancillaryServiceIds"],delete e["_marketplace.selectedInNetworkInsuranceIds"],delete e["_marketplace.selectedInNetworkInsurancePlanIds"],delete e["_marketplace.acceptedInsurancePlanIds"],delete e["_marketplace.allInsurancesAccepted"],e}function E(e,n,t,a){if(!t.hasClass("pending"))return t.addClass("pending"),$.ajax({url:"care-coordination/templates/communities/edit/"+n,beforeSend:function(){$(".ajaxLoader").removeClass("hidden")},complete:function(){$(".ajaxLoader").addClass("hidden")}}).success(function(o){e.empty(),e.append(o),function(e,n){var t=e.find("#communityForm");t.validate(new ExchangeApp.utils.wgt.Validation({ignore:[],scrollToFirstInvalid:!0,container:e.find("#createCommunityModal"),rules:{name:{required:!0,maxlength:100,minlength:3,remote:{url:i,type:"GET",data:{name:t.find("#name").val(),id:n}}},oid:{required:!0,maxlength:30,remote:{url:i,type:"GET",data:{oid:t.find("#oid").val(),id:n}}},phone:{required:!0,maxlength:16,phone:!0},email:{required:!0,maxlength:255,email:!0},street:{minlength:2,maxlength:255,requiredIf:{conditionFunction:x.bind(t,t)}},city:{minlength:2,maxlength:100,requiredIf:{conditionFunction:x.bind(t,t)}},stateId:{requiredIf:{conditionFunction:x.bind(t,t)}},postalCode:{zipcodeUS:!0,requiredIf:{conditionFunction:x.bind(t,t)}},"marketplace.servicesSummaryDescription":{pattern:"[0-9a-zA-Z !\"#$%&'â€™()*+,\\s\\-./:;<=>?@\\\\[\\]^_`{|}~]*"},"marketplace.appointmentsEmail":{maxlength:150,email:!0},"marketplace.appointmentsSecureEmail":{maxlength:150,email:!0,requiredIf:{conditionFunction:w.bind(t,t)}},logo:{fileIsPicture:!0,filesize:1048576,fileRatio:[1.5,5]}},messages:{name:{required:getErrorMessage("field.empty"),remote:"Name of Community should be unique"},oid:{required:getErrorMessage("field.empty"),remote:"Community OID should be unique"},phone:{phone:getErrorMessage("field.phone.format")},street:{requiredIf:"All address fields should be filled, if community is discoverable in Marketplace",skip_or_fill_minimum:"All address fields should be filled, if at least one of the fields is not empty"},city:{requiredIf:"All address fields should be filled, if community is discoverable in Marketplace",skip_or_fill_minimum:"All address fields should be filled, if at least one of the fields is not empty"},stateId:{requiredIf:"All address fields should be filled, if community is discoverable in Marketplace",skip_or_fill_minimum:"All address fields should be filled, if at least one of the fields is not empty"},postalCode:{requiredIf:"All address fields should be filled, if community is discoverable in Marketplace",skip_or_fill_minimum:"All address fields should be filled, if at least one of the fields is not empty"},"marketplace.servicesSummaryDescription":{pattern:"Invalid format. Allowed: letters, numbers, space and special symbols"},"marketplace.appointmentsSecureEmail":{requiredIf:$.validator.messages.required},logo:{fileIsPicture:"File should be of picture format",filesize:"Maximum file size is 1 MB",fileRatio:"Image ratio should be between 1.5:1 and 5:1"}}}))}(e,n),function(e,n){var t=p(),a=$("#createCommWzd");(n===m.ADD||n===m.EDIT&&!j())&&a.tabs({disabled:[1]});t.widgets.createCommWizard=function(e,n){return s.wizard(e,"",n)}(e,{wizardId:"createCommWzd",tabClass:"nav nav-tabs",onNext:function(e,n,t){switch(t){case 1:return j()?a.tabs("enable",t):a.tabs({disabled:[t]}),j();default:return!1}},onFinish:function(e,n,t){return!0},onPrevious:function(e){return a.tabs({active:e}),!0},onTabClick:function(e,n,t,i){if(!(i<=t))switch(i){case 1:return j()?a.tabs({enable:i,active:i}):a.tabs({disabled:[i],active:t}),j();default:return!1}},onTabShow:function(e,n,t){return t=t<0?0:t,a.tabs({active:t}),M(t),!0},nextSelector:g(".wzBtns .next"),previousSelector:g(".wzBtns .previous"),finishSelector:g(".wzBtns .finish")}),function(e){g(".nav>li").removeClass("active"),2!==e&&g(".nav>li:eq("+e+")").addClass("active");g(".nav>li:lt("+e+")").addClass("wz-done"),g(".tab-pane").removeClass("active"),g(".tab-pane:eq("+e+")").addClass("active"),2===e&&g(".tab-pane:eq(1)").addClass("active");M(e)}(t.widgets.createCommWizard.dataset.activeStep),g(".wzBtns .next").removeClass("disabled")}(e,a);var r=e.find("#createCommunityModal"),l=e.find("#saveCommunity"),d=e.find("#allowAppointments"),f=e.find("#commAppointmentsSecureEmail"),h=e.find("#commAppointmentsSecureEmailDiv"),v=e.find("label[for='commAppointmentsSecureEmail']"),y=e.find("#commConfirmVisibilityInMarketplace"),C=r.find(":input.addressPart"),b=r.find("label.addressPart");l.on("click",function(){var t=e.find("#communityForm");if(!t.valid()){var a=$("#legalInfoTab").has(".has-warning").length<=-0;return $("#marketplaceTab").has(".has-warning").length<=-0&&!a&&$("#legalInfoHeadLnk").click(),!1}return $(this).hasClass("pending")||function(e,n,t,a){a.addClass("pending");var i="care-coordination/communities",o="POST",r=!0;n&&(i+="/"+n,o="PUT",r=!1),e.find("#communityOid").removeAttr("disabled");var l=e.serializeJSON(),s=l.logoChanged,d=l.logoRemoved;delete l.logoChanged,delete l.logoRemoved,l=S(l);var m=function(e){p().widgets.communitiesList.api().ajax.reload(),t.modal("hide"),k(e.id,e,r),ExchangeApp.managers.EventManager.publish("community_list_changed")};delete l._csrf,$.ajax({url:i,type:o,contentType:"application/json",dataType:"json",data:JSON.stringify(l),beforeSend:function(e){c.csrf(e)}}).success(function(e){if(1==d){var n="care-coordination/communities/"+e.id+"/logo";$.ajax({url:n,type:"DELETE",cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(e){c.csrf(e)}}).success(function(n){m(e)}).fail(function(n){c.onAjaxError(n,function(){console.log(n),alert("There were problems deleting logo"),m(e)})})}else if(1==s){var t="care-coordination/communities/"+e.id+"/logo",a=$("#logoCommunityInput")[0].files[0],i=new FormData;i.append("logo",a),$.ajax({url:t,type:"POST",data:i,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(e){c.csrf(e)}}).success(function(n){m(e)}).fail(function(n,t){c.onAjaxError(n,function(){console.log(n,t),alert("There were problems updating logo"),m(e)})})}else m(e)}).fail(function(e){c.onAjaxError(e,function(){alert(e.responseText),a.removeClass("pending")})})}(t,n,r,$(this)),!1});var T,E=v.text();function L(e){var n=0,t=$(".organizationWizardContent"),a=$(".table-div");parseInt(e.css("height"),10)>=220?(a&&(n=null!=a.height()?a.height():0),t.css("paddingBottom",25+parseInt(e.css("height"),10)-n+"px")):t.css("paddingBottom",25+parseInt(e.css("height"),10)+"px"),"none"===e.css("display")&&t.css("paddingBottom","25px")}function F(e,n){Array.from(e).forEach(function(e){var t=$(e).children(":first").children(":first");"No networks found"===$(e).text()&&n&&$(e).remove(),null!==t&&t.html($(e).text().fontcolor("#333333")),$(e).show()})}function D(e,n){var t=$("#searchInput");return Array.from(e).forEach(function(e){($(e).hasClass("selected")||"I'll choose my insurance later"===$(e).text())&&($(e).hide(),t.val()&&n.removeClass("search-icon").addClass("cancel-search-icon"))}),e}function P(){var e=$("#tableElement"),t=A($("#selectSearch"));0!==t.length?($.ajax({type:"GET",contentType:"application/json",url:"care-coordination/templates/communities/"+n+"/networks/"+t,dataType:"html"}).success(function(n){e.empty(),e.append(n);var t=e.find(".spicker");t.selectpicker(),t.on("changed.bs.select",c.noneOptionHandler),t.on("changed.bs.select",c.allOptionHandler),e.find("select.spicker").each(function(){var e=$(this);e.selectpicker("val")||e.selectpicker("val",0)})}),e.css("display","block"),e.find(".selectedPlan").find(".filter-option").addClass("network-table-filter-option")):(e.css("display","none"),e.empty())}function _(e){var n=$(e.target),t=$("#tableElement"),a=$("#selectSearch"),i=a.siblings(".dropdown-menu"),o=a.prev().find("ul").find("li"),r=$("#searchIcon"),l=$("#searchInput");if(t.find(".selected-plan").find(".filter-option").addClass("network-table-filter-option"),n.closest("button").parent().hasClass("selected-plan")){var c=n.closest("button").next();c.addClass("plan_select_button_dropdown"),c.find("ul").find("li").find("a").addClass("ellipsis-text"),t.find(".selectedPlan").find(".filter-option").addClass("network-table-filter-option")}else n.is(i)||n.is(l)||n.is(r)||n.parent().hasClass("modal-table-row")||(r.removeClass("cancel-search-icon").addClass("search-icon"),l.val(""),i.css("display","none"),P()),L(i),t.find(".selectedPlan").find(".filter-option").addClass("network-table-filter-option");t.find(".selected-plan").find(".filter-option").addClass("network-table-filter-option"),D(o,r)}d.change(function(){this.checked?v.text(E+"*"):(v.text(E),""===f.val()&&(f.removeClass("error"),h.removeClass("has-warning")))}),d.is(":checked")&&v.text(E+"*"),y.change(function(){this.checked?b.find("span").show():""===C.val()&&(b.find("span").hide(),b.parent().removeClass("has-warning"))}),(""!==C.val()||y.is(":checked"))&&b.find("span").show(),C.change(function(){if($(this).valid()){var n;if(""===$(this).val()){n=""===C.not(this).val();var t=e.find("#communityForm");n&&!x(t)&&b.find("span").hide()}else{var a=C.not(this).map(function(){return $(this).val()});n=-1===$.inArray("",a)&&C.not(this).valid()}n&&b.parent().removeClass("has-warning")}$(this).val().length>1&&b.find("span").show()}),r.modal("show"),r.on("hidden.bs.modal",function(){$(this).remove()}),$("#oidHelp").popover(),$("#communityLogoHelp").popover(),$("#confirmCommunityHelp").popover(),$("#searchInput").on({keyup:function(){var e=$("#searchInput").val().toLowerCase(),n=$("#selectSearch").prev(),t=n.find("ul").find("li"),a=$("#searchIcon");if(n.css("display","block"),a.removeClass("cancel-search-icon").addClass("search-icon"),F(t,!1),null!==e&&""!==e){a.removeClass("search-icon").addClass("cancel-search-icon"),Array.from(t).forEach(function(n){var t=$(n).children(":first").children(":first");if($(n).text().toLowerCase().indexOf(e)<0&&$(n).hide(),null!==t){var a=t.text().toLowerCase().indexOf(e);t.html($(n).text().substring(0,a)+$(n).text().substring(a,a+e.length).fontcolor("#454F81")+$(n).text().substring(a+e.length))}}),t=D(t,a);var i=n.find("ul"),o=i.find("li").filter(":hidden"),r=document.createElement("li");o.length===t.length?($(r).text("No networks found"),i.append(r)):"No networks found"===i.children(":last").text()&&Array.from(i.children()).map(function(e){"No networks found"===$(e).text()&&$(e).remove()})}else F(t,!0),D(t,a);L(n)},click:function(){var e=$("#selectSearch").prev(),n=e.find("ul").find("li");L(e),e.css("display","block"),n=D(n,$(".searchIcon"));var t=function(e){$(e.target).is("#searchInput")||(_(e),$("#createCommunityModal").off("click",t))};$("#createCommunityModal").on("click",t)},blur:function(){var e=$("#selectSearch"),n=e.prev().find("ul").find("li");e.change(function(){$("#tableElement").css("display","none")}),D(n,$("#searchIcon"))}}),$("#tableElement").on("click",".remove-button",function(){var e=$(this).closest("tr").data("network-name"),n=$("#selectSearch"),t=n.prev().find("ul").find("li"),a=$(this);$.each(n.find(":selected"),function(n,t){$(t).text()===e&&$(t).prop("selected",!1)}),$.each(t,function(n,t){$(t).text()===e&&($(t).removeClass("selected"),$(t).show())}),$(this).closest("tr").remove(),0===a.find("td").length&&a.empty()}),$("#searchIcon").on("click",function(){var e=$("#selectSearch").prev();if($(this).hasClass("cancel-search-icon")){var n=e.find("ul").find("li");$("#searchInput").val(""),F(n,!0),D(n,$(this)),$(this).removeClass("cancel-search-icon").addClass("search-icon")}e.css("display","block"),L(e);var t=function(e){$(e.target).is("#searchIcon")||(_(e),$("#createCommunityModal").off("click",t))};$("#createCommunityModal").on("click",t)}),P(),g(":file").each(function(e,n){var t=$(n).attr("data-buttonText"),a="true"==$(n).attr("data-icon"),i=$(n).attr("data-placeholder");$(n).filestyle({icon:a,buttonText:t}),$(n).filestyle("placeholder",i||"File Not Chosen");var o=$('<a href="#" class="cancel-icon" id="removeLogo"></a>');$(".input-group input").after(o),"File Not Chosen"!==i&&""!==i&&$(".cancel-icon").css({paddingTop:"3px",opacity:1,zIndex:3}),$(n).on("change",function(){$(".cancel-icon").css({paddingTop:"3px",opacity:1,zIndex:3}),$("#logoChanged").val(1),$("#logoRemoved").val(0)}),o.on("click",function(){return $("#logoRemoved").val(1),$(n).filestyle("clear"),$(n).filestyle("placeholder","File Not Chosen"),$(n).parents(".form-group").removeClass("has-warning"),$(n).siblings(".bootstrap-filestyle").tooltip("destroy"),$(this).css({paddingTop:0,opacity:0,zIndex:0}),!1})}),t.removeClass("pending"),$("input:checkbox").styler(),T=$("#commPrimaryFocus"),$("#commPrimaryFocus").on("changed.bs.select",function(e,n,t,a){var i=T.selectpicker("val")||[];T.find("option"),u.communityTypesIds(i).then(function(e){var n=$("#commCommunityType"),t=A(n),a="";e.forEach(function(e){a+="<optgroup>",e.forEach(function(e){a+="<option class='optionSpace' value='"+e.id+"'>"+e.label+"</option>"}),a+="</optgroup>"}),n.html(a),n.val(t),n.selectpicker("refresh")}).fail(function(e){}),u.serviceTreatmentApproaches(i).then(function(e){var n=$("#commServicesTreatmentApproaches"),t=A(n),a="";e.forEach(function(e){a+="<optgroup>",e.forEach(function(e){a+="<option class='optionSpace' value='"+e.id+"'>"+e.label+"</option>"}),a+="</optgroup>"}),n.html(a),n.val(t),n.selectpicker("refresh")}).fail(function(e){})});var O=e.find("select.spicker");O.selectpicker(),O.on("changed.bs.select",c.noneOptionHandler),O.on("changed.bs.select",c.allOptionHandler),I("#commAgeGroupsAccepted"),I("#commAncillaryServices"),I("#commEmergencyServices"),$.each(O.selectpicker(),function(e,n){$.each(n,function(e,n){-1!=$(n).val()&&"none"===$(n).text().toLowerCase()?($(n).parent().prev().find("ul").children().eq(e).hide(),$(n).prop("selected")&&$(n).parent().prev().find("ul").children().filter(function(e,n){return"none"===$(n).text().toLowerCase()&&"none"!==$(n).css("display")}).addClass("selected")):$(n).parent().prev().find("li").filter(function(e,n){return"none"!==$(n).text().toLowerCase()&&"none"!==$(n).css("display")}).on("click",function(e){"none"!==$(e.target).text().toLowerCase()&&($(n).parent().find(":selected").filter(function(e,n){return"none"===$(n).text().toLowerCase()}).prop("selected",!1),$(n).parent().prev().find("li").filter(function(e,n){return"none"===$(n).text().toLowerCase()&&"none"!==$(n).css("display")}).removeClass("selected"),$(n).parent().prev().prev().find(".filter-option").text().toLowerCase().replace("none, ",""))})})})}).fail(function(e,n){console.log(e,n),t.removeClass("pending"),alert("Internal server error. Please contact administrator.")}),!1}function M(e){g(".alert").remove(),g(".wzBtns .btn").addClass("hidden"),g([".legalInfoStep",".marketplaceStep"][e]).removeClass("hidden")}ServiceProvider.getService("MarketplaceService").then(function(e){u=e}).fail(function(e){alert(e)});var L=function(e){var n=e.find(".has-warning");n.removeClass("has-warning"),n.find(":input").tooltip("destroy").removeAttr("data-validated")};function j(){var e=$("#communityForm").valid(),n=$("#legalInfoTab").has(".has-warning").length<=0;return e||L($("#marketplaceTab")),!!e||n}return{init:function(n,t){a=n,e=t,this.loadFragment({onFragmentLoaded:function(){f()},onResourcesLoaded:function(){var e=p();e.widgets={},T(),this.setEvents(),e.inited=!0,this.render(),this.show()}})},update:function(e){a=e,n!=ExchangeApp.modules.Header.getCurrentOrganizationFilter()&&ExchangeApp.routers.ModuleRouter.reload()},getFragment:function(e){return t[v(e,{params:!0})]},isFragmentInited:function(e){var n=this.getFragment(e);return n&&n.inited},loadFragment:function(e){var n=this;d.load({url:a,callbacks:{onFragmentLoaded:function(i){r.reloadNeeded=!1;var o=$(i).find("#content").children(),l=v(a,{params:!0});t[l]={$html:o,url:c.clone(a)},e.onFragmentLoaded.apply(n)},onResourcesLoaded:function(){e.onResourcesLoaded.apply(n),g("input").styler()}}})},render:function(){var e=p().$html;h().empty(),h().append(e)},hide:function(){h().hide(),$("#content").addClass("loading")},show:function(){0==$("#content").find(".tab-pane:visible").length&&($.each($("#care-coordination").find(".nav li"),function(){$(this).removeClass("active")}),$('a[data-target^="#'+o+'"]').parent("li").addClass("active"),h().show()),$("#content").removeClass("loading")},setEvents:function(){return g("#createCommunity").on("click",function(){E(g("#createCommunityContainer"),0,$(this),m.ADD)}),g("#searchCommunity").on("click",function(){return p().widgets.communitiesList.api().ajax.reload(),!1}),!1},reloadNeeded:function(){return r.reloadNeeded},getParentModule:function(){return e},showCommunityDetails:function(e,n,t){k(e,n,t)}}}();