define(["underscore","superagent",path("app/lib/Utils"),path("app/lib/Constants"),path("app/lib/mock/MockData"),path("app/lib/errors/ServerError"),path("app/lib/errors/NetworkError"),path("app/lib/errors/ServerResponseError")],function(e,t,n,r,o,s,i,a){function c(e){var t=null;try{t=JSON.parse(e.text)}catch(t){throw new a({status:"Response parse error",body:e.body})}var n=t.body,r=t.statusCode;if((200===r||201===r)&&!1!==n.success)return n;if(n.crossDomain||n.code===u.CONNECTION_ABORTED){if(r)throw new s(p.serverInternal.error);throw new i(p.noConnectionOrServerIsNotAvailable.error)}throw new s({status:r,body:n})}function d(e){if(e.crossDomain){if(e.status)throw new s(p.serverInternal.error);throw new i(p.noConnectionOrServerIsNotAvailable.error)}throw new s({body:e&&e.body?e.body:e})}function l(){}var u=r.SERVER_ERROR_TYPES,p={serverInternal:{error:{code:u.INTERNAL_SERVER_ERROR,message:"Internal Server Error.\n During the query execution, errors occurred on the server. Please, contact Support."}},noConnectionOrServerIsNotAvailable:{error:{code:u.NO_CONNECTION_OR_SERVER_IS_NOT_AVAILABLE,message:n.interpolate("HTTP Request has been terminated.\n Possible causes:\n\n - $1\n - $2","No Internet connection. Make sure that Wi-Fi or cellular mobile data is turned on.","Server is not available. Please, try to connect again later.")}}},f=[],h=ExchangeApp.info.context,v=ExchangeApp.utils.auth;return l.prototype.request=function(n){var r=e.some(f,function(e){return n.url.includes(e)}),s=(n=e.extend({method:"GET",url:null,body:null,type:"json",params:null,callback:null},n)).method;if(r)return new Promise(function(e,t){var r=n.url;setTimeout(function(){/states/.test(r)?e(o.findStates()):/genders/.test(r)?e(o.findGenders()):/races/.test(r)?e(o.findRaces()):/problems/.test(r)?e(o.findDiagnoses()):/active-medications/.test(r)?e(o.findMedications()):/inactive-medications/.test(r)?e(o.findMedications()):/incident-places/.test(r)?e(o.findIncidentPlaces()):/incidents/.test(r)?e(o.findIncidentTypes(n.data)):/incident-places/.test(r)?e(o.findIncidentPlaces()):/incident-level-reporting-settings/.test(r)?e(o.findIncidentLevelReportingSettings()):/incident-reports/.test(r)?"PUT"!==s&&"POST"!==s||e(o.saveIncidentReport(n.data)):/incident-report-drafts/.test(r)&&("PUT"!==s&&"POST"!==s||e(o.saveIncidentReportDraft(n.data)))},1e3)}).then(c);var i=n.type,a=h+n.url;if("POST"===s||"PUT"===s){l=t(s,a).withCredentials().type(i).set("X-CSRF-TOKEN",v.getToken()).timeout({response:15e3});return"multipart/form-data"===i?e.each(n.body,function(t,n){t instanceof File?l=l.attach(n,t):(e.isObject(t)&&(t=JSON.stringify(t)),l=l.field(n,t))}):l=l.send(n.body),l.then(c,d)}if("DELETE"===s)return t.del(a).set("X-CSRF-TOKEN",v.getToken()).timeout({response:15e3}).then(c,d);if("GET"===s){var l=t.get(a).set("X-CSRF-TOKEN",v.getToken()).timeout({response:15e3}),u=n.headers;return u&&e.each(e.keys(u),function(e){l.set(e,u[e])}),l.query(n.params).send(n.body).then(c,d)}},l});