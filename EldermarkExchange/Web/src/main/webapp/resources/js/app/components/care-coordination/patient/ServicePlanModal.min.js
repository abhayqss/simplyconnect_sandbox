var ServicePlanModal=function(t){function e(){Modal.apply(this,arguments);var t=this.props.isReadonlyPlan;this.state={bodyMinHeight:null,isScrollerShowed:!1,isCloseBtnShowed:t,isCancelBtnShowed:!t,isNextBtnShowed:!1,isBackBtnShowed:!1,isSaveBtnShowed:!t},this.scoringTooltip=null}var o=ExchangeApp.info.context+"/resources/images/arrow2-top.svg",i=ExchangeApp.info.context+"/resources/images/info-tip-white.svg",n=["Client has no capability or resource in the area; requires immediate intervention or correction; client is at serious risk if not addressed","Client has limited capabilities in this area or current or historical resources are unreliable or inconsistent","Client some resources or capability in this area; has developed workarounds or relies on caregivers/others for some assistance on a regular or consistent basis; could benefit from self-management development","Client is generally capable of self-management or accomplishing issues but could benefit from tweaking or additional services/education; caregiver or external assistance is minimal or minor","Does not apply or Client is fully capable of self-management or can accomplish all issues on their own"];return e.prototype=Object.create(Modal.prototype),e.prototype.constructor=e,e.prototype.getDefaultProps=function(){var e=this,n=Modal.prototype.getDefaultProps.apply(this);return t.extend({},n,{isStatic:!0,isReadonlyPlan:!1,footerHeight:80,className:"",bodyExtraHeight:60,getTitle:function(){return e.props.isReadonlyPlan?"View Service Plan":e.props.planId>=0?"Edit Service Plan":"Create Service Plan"},renderTitle:function(){return{"<>":"h4",class:"modal-title",html:[{"<>":"div",class:"modal-title__text",text:e.props.getTitle()||e.props.title},{"<>":"div",class:"tooltip-btn hidden",html:[{"<>":"img",class:"tooltip-btn__image",src:i}]}]}},renderFooter:function(){return{"<>":"div",class:"modal-footer scroller-container",html:[{"<>":"button",class:"btn btn-default close-btn "+(e.state.isCloseBtnShowed?"":"hidden"),style:"margin-right: 24px; ","data-dismiss":"modal",text:"CLOSE"},{"<>":"button",class:"btn btn-default cancel-btn "+(e.state.isCancelBtnShowed?"":"hidden"),style:"margin-right: 24px; ","data-dismiss":"modal",text:"CANCEL"},{"<>":"button",class:"btn btn-default back-btn "+(e.state.isBackBtnShowed?"":"hidden"),style:"margin-right: 24px",text:"BACK",onclick:function(){e.onBack()}},{"<>":"button",class:"btn btn-primary next-btn "+(e.state.isNextBtnShowed?"":"hidden"),text:"NEXT",onclick:function(){e.onNext()}},{"<>":"button",class:"btn btn-primary save-btn "+(e.state.isSaveBtnShowed?"":"hidden"),text:"SAVE",onclick:function(){e.onSave()}},{"<>":"div",title:"Back to Top",class:"up-scroller",html:[{"<>":"img",src:o}],onclick:function(){e.scrollToStart()}}]}},onLeavePlanUnchanged:function(){},onSavePlanSuccess:function(){},onSavePlanFailure:function(){},onLoadPlanFailure:function(){},onHidden:function(){}})},e.prototype.componentDidMount=function(){Modal.prototype.componentDidMount.apply(this);var t=this,e=this.props.planId,o=this.props.patientId,i=this.props.planDateModified,s=this.props.isReadonlyPlan,a=this.props.isArchivedPlan;this.scoringTooltip=new Popover({element:this.$header.find(".tooltip-btn"),className:"custom-tooltip scoring-tooltip",isHtmlUsed:!0,trigger:"hover",viewport:{selector:this.$content.selector,padding:10},onShow:function(){t.setState({bodyMinHeight:400})},onHidden:function(){t.setState({bodyMinHeight:""})},renderTitle:function(){return[{"<>":"div",class:"scoring-tooltip__title-item score",text:"Score"},{"<>":"div",class:"scoring-tooltip__title-item parameters",text:"Guidelines/Parameters"}]},renderContent:function(){return[_.map(n,function(t,e){return{"<>":"div",class:"scoring-tooltip__content-row",html:[{"<>":"div",class:"scoring-tooltip__content-cell score",text:String(n.length-e)},{"<>":"div",class:"scoring-tooltip__content-cell parameters",text:t}]}})]}}),this.scoringTooltip.mount(),s&&!a?(this.tabs=new ServicePlanDetailedInfoTabs({container:this.$body,planId:e,patientId:o,planDateModified:i,currentUser:this.props.currentUser,onLoadPlanFailure:function(e){t.props.onLoadPlanFailure(e)},onViewArchivedPlan:function(e){t.props.onViewArchivedPlan(e)}}),this.tabs.mount(),this.addOnShownHandler(function(){var e=parseInt(t.$body.css("max-height"));t.tabs.update({maxHeight:e})}),this.addOnResizeHandler(function(){var e=parseInt(t.$body.css("max-height"));t.tabs.update({maxHeight:e})})):(this.details=new ServicePlanDetails({container:this.$body,planId:e,patientId:o,isReadonly:s,currentUser:this.props.currentUser,onLoadSuccess:function(e){s||(e.needs&&e.needs.length>0?t.setState({isNextBtnShowed:!0,isSaveBtnShowed:!1}):t.setState({isSaveBtnShowed:!0,isNextBtnShowed:!1}))},onLoadFailure:function(e){t.props.onLoadPlanFailure(e)},onValidationError:function(){var e=t.details.getInvalidItems();t.scrollTo(e.first())},onSaveSuccess:function(){t.props.onSavePlanSuccess()},onSaveFailure:function(){t.props.onSavePlanFailure()},onShowDatePicker:function(){t.setState({bodyMinHeight:510})},onHideDatePicker:function(){t.setState({bodyMinHeight:""})},onNeedSectionAdded:function(e){var o=t.details.getNeedSection(e);t.scrollTo(o.$element),t.state.isNextBtnShowed||t.setState({isNextBtnShowed:!0,isSaveBtnShowed:!1})},onNeedSectionRemoved:function(){0===t.details.getNeedSectionCount()&&t.setState({isNextBtnShowed:!1,isSaveBtnShowed:!0})},onGoalSectionAdded:function(e,o){var i=t.details.getNeedSection(e).getGoalSection(o);t.scrollTo(i.$element)}}),this.details.mount()),this.addOnHiddenHandler(function(){t.props.onHidden(),t.unmount()}),this.addOnScrollHandler(function(e){var o=e.target.scrollTop,i=e.target.clientHeight,n=t.state.isScrollerShowed;o>i/2?!n&&t.setState({isScrollerShowed:!0}):n&&t.setState({isScrollerShowed:!1})})},e.prototype.componentDidUpdate=function(t,e){var o=this.state.bodyMinHeight;o!==e.bodyMinHeight&&this.$body.css({minHeight:o});var i=this.state.isScrollerShowed;i!==t.isScrollerShowed&&(i?this.showUpScroller():this.hideUpScroller());var n=this.state.isCancelBtnShowed,s=this.state.isNextBtnShowed,a=this.state.isBackBtnShowed,r=this.state.isSaveBtnShowed;if(n!==e.isCancelBtnShowed){l=this.$footer.find(".cancel-btn");n?l.removeClass("hidden"):l.addClass("hidden")}if(s!==e.isNextBtnShowed){l=this.$footer.find(".next-btn");s?l.removeClass("hidden"):l.addClass("hidden")}if(a!==e.isBackBtnShowed){var l=this.$footer.find(".back-btn"),d=this.$header.find(".modal-title__text"),c=this.$header.find(".tooltip-btn");if(a)l.removeClass("hidden"),d.text("Scoring"),c.removeClass("hidden");else{l.addClass("hidden");var h=this.props.getTitle()||this.props.title;d.text(h),c.addClass("hidden")}}if(r!==e.isSaveBtnShowed){l=this.$footer.find(".save-btn");r?l.removeClass("hidden"):l.addClass("hidden")}},e.prototype.scrollToStart=function(){this.$body.scrollTo(0,500)},e.prototype.scrollTo=function(t){this.$body.scrollTo(t,500)},e.prototype.hideUpScroller=function(){this.$element.find(".up-scroller").hide()},e.prototype.showUpScroller=function(){this.$element.find(".up-scroller").show()},e.prototype.onBack=function(){this.setState({isCancelBtnShowed:!0,isNextBtnShowed:!0,isBackBtnShowed:!1,isSaveBtnShowed:!1}),this.details.hideScoringSection(),this.details.removeScoringSection()},e.prototype.onNext=function(){this.details.isValid()&&(this.setState({isCancelBtnShowed:!1,isNextBtnShowed:!1,isBackBtnShowed:!0,isSaveBtnShowed:!0}),this.details.createScoringSection(!1),this.details.showScoringSection())},e.prototype.onSave=function(){this.details.hasScoringSection()?this.details.isChanged()?this.details.save():this.props.onLeavePlanUnchanged():this.details.isValid()&&(this.details.isChanged()?this.details.save():this.props.onLeavePlanUnchanged())},e.prototype.addOnScrollHandler=function(t){this.$body.on("scroll",t)},e.prototype.render=function(){var t=this.props.isStatic,e=this.props.isScrollable,o=!this.props.planId,i=this.props.isReadonlyPlan,n=this.props.isArchivedPlan,s="modal fade service-plan-modal ",a="";return(a+=o?"new":n?"archived":i?"readonly":"edit")&&(s+=a+" "),{"<>":"div",class:s+this.props.className+(e?"":"non-scrollable"),"data-backdrop":!t||"static",html:[{"<>":"div",class:"modal-dialog",style:"width:1000px;",html:[{"<>":"div",class:"modal-content",html:[this.props.renderHeader(),this.props.renderBody(),this.props.renderFooter()]}]}]}},e}($);