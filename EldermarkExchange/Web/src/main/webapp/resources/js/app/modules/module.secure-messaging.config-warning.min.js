ExchangeApp.modules.SecureMessagingConfigWarning=function(){function e(){n().random=s.rand(),function(e,t){var r=n(),o=e||r.$html,a=t||r.random;o=s.randomize(o,a,!1)}()}function n(){return d[o(c,{params:!0})]}function t(){return o(c,{params:!0}).replace(/[/&\?=]/g,"_")}function r(){return $(document.getElementById(t()))}function o(e,n){return s.stringifyUrl(e,n)}function a(e){var t=n();return s.alert(t.$html,t.random,e)}function i(){(function(e){var t=n();return s.find(t.$html,t.random,e)})("#activateSesBtn").on("click",function(e){$(e.target).prop("disabled",!0),$.ajax({url:"secure-messaging/activate",type:"POST",beforeSend:function(e){s.csrf(e)},success:function(n){$(e.target).prop("disabled",!1),a({action:"add",type:"alert alert-info",placeSelector:".msgConfigWarningBox .boxBody",message:"Your Secure Messaging account was activated successfully.",closable:{btn:!0}}),window.setTimeout(function(){var e=ExchangeApp.routers.ModuleRouter,n=s.getUrl("secure-messaging",null,null);e.route(n),e.reload()},2e3)},error:function(n){$(e.target).prop("disabled",!1),s.onAjaxError(n,function(e){a({action:"add",placeSelector:".msgConfigWarningBox .boxBody",message:e.responseText,closable:{timer:45e3,btn:!0}})})}})})}var d={},c={template:"secure-messaging/config-warning"},u={reloadNeeded:!1},s=ExchangeApp.utils.module,l=ExchangeApp.loaders.FragmentLoader.init("secureMessagingConfigWarning");return{init:function(t){c=t,this.renderHolder(),this.loadFragment({onFragmentLoaded:function(){e()},onResourcesLoaded:function(){var e=n();e.widgets={},i(),this.setEvents(),this.render(),e.inited=!0}})},update:function(e){c=e},loadFragment:function(e){var n=this;l.load({url:c,callbacks:{onFragmentLoaded:function(t){u.reloadNeeded=!1;var r=$(t).find("#content .markup-frg"),a=o(c,{params:!0});d[a]={$html:r,url:s.clone(c)},e.onFragmentLoaded.apply(n)},onResourcesLoaded:function(){e.onResourcesLoaded.apply(n)}}})},render:function(){var e=n().$html;r().empty(),r().append(e)},renderHolder:function(){if(!document.getElementById(t())){var e=$("<div/>");e.attr("id",t()),e.hide(),$("#content").append(e)}},hide:function(){r().hide()},show:function(){r().show()},getFragment:function(e){return d[o(e,{params:!0})]},isFragmentInited:function(e){var n=this.getFragment(e);return n&&n.inited},setEvents:function(){},reloadNeeded:function(){return u.reloadNeeded}}}();