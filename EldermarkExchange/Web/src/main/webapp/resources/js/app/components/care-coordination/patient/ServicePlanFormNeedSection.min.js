ServicePlanForm.NeedSection=function(){function t(t){return!t||0===Object.keys(t).length}function e(t,e,a){bootbox.confirm({message:t,buttons:{cancel:{label:"Cancel"},confirm:{label:"Ok"}},callback:function(t){t?e&&e():a&&a()}})}function a(){Widget.apply(this,arguments),this.goals=[],this.state={data:this.props.data}}var o=ExchangeApp.info.context+"/resources/images/add-button-rounded.svg";return a.prototype=Object.create(Widget.prototype),a.prototype.constructor=a,a.prototype.getDefaultProps=function(){return{index:0,data:{},isReadonly:!1,onRemove:function(){},onChangeType:function(){},onGoalSectionAdded:function(){},onGoalSectionRemoved:function(){}}},a.prototype.onChange=function(t){var a=$(t.target),o=a.attr("data-name");if(!!a.attr("data-need-field")){var n=a.val(),i=$.extend({},this.state.data);if(i[o]=n,"type"===o){var s=this.state.data.type,l="Relevant Activation or Education Task";if(n===l||s===l)if(i={},i[o]=n,this.isNotEmpty({exclude:["type"]})){var d=this;e(s===l?"Relevant Activation or Education Task will be deleted":"Need / Opportunity with the related goals will be deleted",function(){d.goals=[],d.props.onChangeType(n,d.props.index),d.setState({data:i})},function(){a.val(d.state.data.type)})}else this.goals=[],this.props.onChangeType(n,this.props.index),this.setState({data:i});else this.props.onChangeType(n,this.props.index),this.setState({data:i})}else{"date"===(a.attr("data-type")||a.attr("type"))&&(i[o]=t.date?t.date.toDate().getTime():""),this.setState({data:i})}}},a.prototype.onRemove=function(){var t=this.props.onRemove,e=this.props.index;this.remove(function(){t&&t(e)})},a.prototype.onAddGoalSection=function(){var t=this,e=new ServicePlanForm.NeedSection.GoalSection({container:this.$element.find(".goal-section-list"),index:this.goals.length,needIndex:this.props.index,isReadonly:this.props.isReadonly,onRemove:function(e){t.onRemoveGoalSection(e)}});e.mount(),this.goals.push(e),this.props.onGoalSectionAdded()},a.prototype.onRemoveGoalSection=function(t){this.goals=$.map(this.goals,function(e,a){if(a!==t)return e}),$.each(this.goals,function(t,e){e.update({index:t})}),this.props.onGoalSectionRemoved()},a.prototype.componentDidMount=function(){this.$element=$('[cmp-id="'+this.$$id+'"]'),this.dom=this.$element.get(0);var t=this;this.$element.find('input[data-type="date"]').datetimepicker({format:"MM/DD/YYYY HH:mm",widgetPositioning:{vertical:"bottom"}}).on("dp.change",function(e){t.onChange(e)});var e=this.props.isReadonly;this.$element.find("input, select, textarea").each(function(){var t=$(this);t.attr("name");!!t.attr("data-need-field")&&(t.is('textarea[data-autoresizable="true"]')&&t.autoresize(),e&&t.attr(t.is("select")?"disabled":"readonly","true"))});var a=this.props.data.goals;if(a){var o=this.props.index;$.each(a,function(a,n){var i=new ServicePlanForm.NeedSection.GoalSection({container:t.$element.find(".goal-section-list"),index:a,needIndex:o,data:n,isReadonly:e,onRemove:function(e){t.onRemoveGoalSection(e)}});i.mount(),t.goals.push(i)})}this.addOnChangeHandler(function(e){t.onChange(e)})},a.prototype.componentDidUpdate=function(t,e){var a=this.props.index;a!==t.index&&(this.$element.find(".anchor").attr("name","need-"+a),this.$element.find(".section__header h4").text("Need / Opportunity #"+(a+1)));var o=this.state.data.type;if(o!==e.data.type){var n="Relevant Activation or Education Task";o!==n&&e.data.type!==n||this.remount()}},a.prototype.addOnChangeHandler=function(t){this.$element.on("change",t)},a.prototype.remove=function(t){if(this.isNotEmpty()){var a=this;e("Relevant Activation or Education Task"===this.state.data.type?"Relevant Activation or Education Task will be deleted":"Need / Opportunity with the related goals will be deleted",function(){t&&t(),a.unmount()})}else t&&t(),this.unmount()},a.prototype.getIndex=function(){return this.props.index},a.prototype.getGoalSection=function(t){return this.goals[t]},a.prototype.getData=function(){var e=$.map(this.goals,function(e){var a=e.getData();if(!t(a))return a});return $.extend({},this.state.data,{goals:e||[]})},a.prototype.isNotEmpty=function(e){var a=!1,o=this.getData(),n=(e||{}).exclude||[];return $.each(o,function(e,o){~n.indexOf(e)||t(o)||(a=!0)}),a},a.prototype.isChanged=function(){var t=this;return _.any(this.state.data,function(e,a){return"goals"===a?e?e.length!==t.goals.length||_.any(t.goals,function(t){return t.isChanged()}):t.goals.length>0:e!==t.props.data[a]})},a.prototype.render=function(){var t=this,e=this.props.index,a=this.props.isReadonly,n=this.state.data,i=n.type,s=n.goals,l=n.priority,d="Relevant Activation or Education Task"===i;return{"<>":"div",class:"form-section need-section",html:[{"<>":"div",class:"section__header need-section__header",html:[{"<>":"div",class:"row",html:[{"<>":"div",class:"col-md-6",html:[{"<>":"a",name:"need-"+e,class:"anchor"},{"<>":"h4",text:"Need / Opportunity #"+(e+1)}]},{"<>":"div",class:"col-md-6",html:[a?void 0:{"<>":"a",class:"add-button pull-right",html:[{"<>":"span",text:"Remove"}],onclick:function(){t.onRemove(e)}}]}]}]},{"<>":"div",class:"need-section__body",html:[{"<>":"div",class:"row",html:[{"<>":"div",class:"col-md-6",html:[{"<>":"div",class:"form-group",html:[{"<>":"label",text:"Domain*"},{"<>":"select",name:"need."+e+".type","data-name":"type","data-need-field":!0,class:"form-control",placeholder:"Select",html:[$.map(["Select","Behavioral / Spiritual Health","Caregiver Resource / Support","Employment","Health Status","Housing","Housing / Home Security & Safety","Mental wellness","Nutrition Security","Other / Non-Specific","Physical wellness","Relevant Activation or Education Task","Social wellness","Transportation","Legal","Finances","Medical / Other Supply","Medication Management and Assistance","Home Health"],function(t){var e={"<>":"option",text:t};return"Select"===t&&$.extend(e,{value:"",hidden:!0},!i&&{selected:!0}),t===i&&$.extend(e,{selected:!0}),e})]}]}]},{"<>":"div",class:"col-md-6",html:[{"<>":"div",class:"form-group",html:[{"<>":"label",text:"Priority*"},{"<>":"select",name:"need."+e+".priority","data-name":"priority","data-need-field":!0,class:"form-control",html:[$.map(["Select","High","Medium","Low"],function(t){var e={"<>":"option",text:t};return"Select"===t&&$.extend(e,{value:"",hidden:!0},!l&&{selected:!0}),t===l&&$.extend(e,{selected:!0}),e})]}]}]}]},{"<>":"div",class:"row",html:[{"<>":"div",class:"col-md-12",html:[{"<>":"div",class:"form-group",html:[{"<>":"label",text:d?"Activation or Education Task*":"Need / Opportunity*"},{"<>":"textarea",rows:1,name:"need."+e+(d?".activationOrEducationTask":".needOpportunity"),"data-name":d?"activationOrEducationTask":"needOpportunity","data-need-field":!0,"data-autoresizable":!0,class:"form-control autoresizable",text:(d?n.activationOrEducationTask:n.needOpportunity)||""}]}]}]},d?{"<>":"div",class:"row",html:[{"<>":"div",class:"col-md-6",html:[{"<>":"div",class:"form-group",html:[{"<>":"label",text:"Target Completion Date*"},{"<>":"input",name:"need."+e+".targetCompletionDate","data-name":"targetCompletionDate","data-need-field":!0,type:"text","data-type":"date",class:"form-control",placeholder:"mm/dd/yyyy hh:mm",value:n.targetCompletionDate&&new Date(n.targetCompletionDate).format("mm/dd/yyyy HH:MM")}]}]},{"<>":"div",class:"col-md-6",html:[{"<>":"div",class:"form-group",html:[{"<>":"label",text:"Completion Date"},{"<>":"input",name:"need."+e+".completionDate","data-name":"completionDate","data-need-field":!0,type:"text","data-type":"date",class:"form-control",placeholder:a?"":"mm/dd/yyyy hh:mm",value:n.completionDate&&new Date(n.completionDate).format("mm/dd/yyyy HH:MM")}]}]}]}:void 0,d?void 0:{"<>":"div",class:"row",html:[{"<>":"div",class:"col-md-12",html:[{"<>":"div",class:"form-group",html:[{"<>":"label",for:"createdDate",text:"Proficiency / Graduation Criteria"},{"<>":"textarea",rows:4,name:"need."+e+".proficiencyGraduationCriteria","data-name":"proficiencyGraduationCriteria","data-need-field":!0,"data-autoresizable":!0,style:"min-height: 82px",class:"form-control autoresizable",text:n.proficiencyGraduationCriteria||""}]}]}]},d||a&&!s?void 0:{"<>":"div",class:"form-section-list goal-section-list",html:[{"<>":"div",class:"row form-section-list__header goal-section-list__header",html:[{"<>":"div",class:"col-md-6",html:[{"<>":"h4",text:"Goals"}]},{"<>":"div",class:"col-md-6",html:[a?void 0:{"<>":"a",class:"add-button pull-right",onclick:function(){t.onAddGoalSection()},html:[{"<>":"img",src:o},{"<>":"span",text:"Add a Goal"}]}]}]}]}]}]}},a}($);