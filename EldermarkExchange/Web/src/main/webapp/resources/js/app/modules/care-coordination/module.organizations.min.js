ExchangeApp.modules.CareCoordinationOrganizations=function(){function e(){a().random=S.rand(),function(e,t){var n=a(),i=e||n.$html,r=t||n.random;i=S.randomize(i,r,!1)}(),function(e,t){var i=a();i.ajaxMap||(i.ajaxMap={});var r=e||i.$html,s=t||i.random,o=S.findAjaxUrls(r,s);$.each(o,function(e,a){i.ajaxMap[n(a,{params:!0})]=a}),S.find(r,s,'[data-ajax-load="true"]').on("click",function(){var e=$(this).attr("data-ajax-url-tmpl"),a=$(this).attr("data-ajax-url-vars"),t=$(this).attr("data-ajax-url-params"),n=S.getUrl(e,a,t);return x.route(n),!1}),S.find(r,s,'[data-ajax-anchor="true"]').on("click",function(){var e=$($(this).attr("href"));return e.length&&$("html, body").animate({scrollTop:e.offset().top},200),!1})}()}function a(){return w[n(b,{params:!0})]}function t(){return $('[id^="'+y+'"]')}function n(e,a){return S.stringifyUrl(e,a)}function i(e){var t=a();return S.find(t.$html,t.random,e)}function r(e){return e.find("#orgConfirmVisibilityInMarketplace").is(":checked")}function s(e){var a=0,t=0,n=$(e).find("option")[0],i=$(n).parent().prev();$(e);$(i).find("ul").children().filter(function(e,n){"None"!=n.outerText&&"All"!=n.outerText&&0!=n.outerText.length||t++,"selected"===$(n).attr("class")&&a++});var r=$(i).find("ul").children().length-t;if(a===r){var s=$(i).prev().find("span")[0];$(s).text("All"),$(e).val(0),$(i).find("ul").children().filter(function(e,a){$(a).removeClass("selected"),"All"==a.outerText&&$(a).addClass("selected")})}}function o(e){var a=e.selectpicker("val")||[];if(a.indexOf("0")>-1){var t=e.find("option");return $.map(t,function(e){return e.value}).filter(function(e){return e&&parseInt(e,10)>0})}return a.indexOf("-1")>-1?$.map(t,function(e){if("none"===e.innerText.toLowerCase())return e.value}).filter(function(e){return e&&parseInt(e,10)>0}):a}function l(e){$("#orgPrimaryFocus").on("changed.bs.select",function(a,t,n,i){var r=e.selectpicker("val")||[];e.find("option");T.communityTypesIds(r).then(function(e){var a=$("#orgCommunityType"),t=o(a),n="";e.forEach(function(e){n+="<optgroup>",e.forEach(function(e){n+="<option class='optionSpace' value='"+e.id+"'>"+e.label+"</option>"}),n+="</optgroup>"}),a.html(n),a.val(t),a.selectpicker("refresh")}).fail(function(e){}),T.serviceTreatmentApproaches(r).then(function(e){var a=$("#orgServicesTreatmentApproaches"),t=o(a),n="";e.forEach(function(e){n+="<optgroup>",e.forEach(function(e){n+="<option class='optionSpace' value='"+e.id+"'>"+e.label+"</option>"}),n+="</optgroup>"}),a.html(n),a.val(t),a.selectpicker("refresh")}).fail(function(e){})})}function d(e){return e.marketplace={},e.marketplace.confirmVisibility=e["marketplace.confirmVisibility"],e.marketplace.servicesSummaryDescription=e["marketplace.servicesSummaryDescription"],e.marketplace.prerequisite=e["marketplace.prerequisite"],e.marketplace.exclusion=e["marketplace.exclusion"],e.marketplace.allowAppointments=e["marketplace.allowAppointments"],e.marketplace.appointmentsEmail=e["marketplace.appointmentsEmail"],e.marketplace.appointmentsSecureEmail=e["marketplace.appointmentsSecureEmail"],e.marketplace.allInsurancesAccepted=e["marketplace.allInsurancesAccepted"],e.marketplace.primaryFocusIds=o($("#orgPrimaryFocus")),e.marketplace.communityTypeIds=o($("#orgCommunityType")),e.marketplace.levelOfCareIds=o($("#orgLevelsOfCare")),e.marketplace.ageGroupIds=o($("#orgAgeGroupsAccepted")),e.marketplace.serviceTreatmentApproachIds=o($("#orgServicesTreatmentApproaches")),e.marketplace.emergencyServiceIds=o($("#orgEmergencyServices")),e.marketplace.languageServiceIds=o($("#orgLanguageServices")),e.marketplace.ancillaryServiceIds=o($("#orgAncillaryServices")),e.marketplace.selectedInNetworkInsurancePlanIds=function(){var e={};return $("#in-network-insurance-table").find("tr").each(function(){var a=$(this);if(a.attr("role")){var t=a.data("network-id");if(t){var n=a.find("select.selected-plan");e[t]=n.size()?o(n):[]}}}),e}(),delete e["marketplace.confirmVisibility"],delete e["marketplace.servicesSummaryDescription"],delete e["marketplace.prerequisite"],delete e["marketplace.exclusion"],delete e["marketplace.allowAppointments"],delete e["marketplace.appointmentsEmail"],delete e["marketplace.appointmentsSecureEmail"],delete e["marketplace.primaryFocusIds"],delete e["marketplace.communityTypeIds"],delete e["marketplace.levelOfCareIds"],delete e["marketplace.ageGroupIds"],delete e["marketplace.serviceTreatmentApproachIds"],delete e["marketplace.emergencyServiceIds"],delete e["marketplace.languageServiceIds"],delete e["marketplace.ancillaryServiceIds"],delete e["marketplace.selectedInNetworkInsuranceIds"],delete e["marketplace.selectedInNetworkInsurancePlanIds"],delete e["marketplace.acceptedInsurancePlanIds"],delete e["marketplace.allInsurancesAccepted"],delete e["_marketplace.confirmVisibility"],delete e["_marketplace.allowAppointments"],delete e["_marketplace.primaryFocusIds"],delete e["_marketplace.communityTypeIds"],delete e["_marketplace.levelOfCareIds"],delete e["_marketplace.ageGroupIds"],delete e["_marketplace.serviceTreatmentApproachIds"],delete e["_marketplace.emergencyServiceIds"],delete e["_marketplace.languageServiceIds"],delete e["_marketplace.ancillaryServiceIds"],delete e["_marketplace.selectedInNetworkInsuranceIds"],delete e["_marketplace.selectedInNetworkInsurancePlanIds"],delete e["_marketplace.acceptedInsurancePlanIds"],delete e["_marketplace.allInsurancesAccepted"],e}function c(e,a){$.ajax({url:"care-coordination/organizations/password-settings/"+a,beforeSend:function(){$(".ajaxLoader").removeClass("hidden")},complete:function(){$(".ajaxLoader").addClass("hidden")}}).success(function(t){e.empty(),e.append(t),function(e){e.find("#passwordSettingsForm").validate(new ExchangeApp.utils.wgt.Validation({rules:{"databasePasswordSettingsList[0].value":{positiveInteger:!0,max:999,required:!0},"databasePasswordSettingsList[1].value":{positiveInteger:!0,max:999,required:!0},"databasePasswordSettingsList[2].value":{positiveInteger:!0,max:function(){var e=99999;if($("#passwordSettings3").is(":checked")&&$.isNumeric($("#passwordSettings3Value").val())){var a=parseInt($("#passwordSettings3Value").val());a>0&&(e=a)}return e},required:!0},"databasePasswordSettingsList[3].value":{positiveInteger:!0,max:99999,required:!0,min:function(){var e=0;if($("#passwordSettings2").is(":checked")&&$.isNumeric($("#passwordSettings2Value").val())){var a=parseInt($("#passwordSettings2Value").val());a>0&&(e=a)}return e}},"databasePasswordSettingsList[4].value":{positiveInteger:!0,max:20,required:!0,min:function(){var e=0;return $("#passwordSettings5").is(":checked")?e+=$.isNumeric($("#passwordSettings5Value").val())?parseInt($("#passwordSettings5Value").val()):0:($("#passwordSettings6").is(":checked")&&(e+=$.isNumeric($("#passwordSettings6Value").val())?parseInt($("#passwordSettings6Value").val()):0),$("#passwordSettings7").is(":checked")&&(e+=$.isNumeric($("#passwordSettings7Value").val())?parseInt($("#passwordSettings7Value").val()):0)),$("#passwordSettings8").is(":checked")&&(e+=$.isNumeric($("#passwordSettings8Value").val())?parseInt($("#passwordSettings8Value").val()):0),$("#passwordSettings9").is(":checked")&&(e+=$.isNumeric($("#passwordSettings9Value").val())?parseInt($("#passwordSettings9Value").val()):0),e>8?e:8}},"databasePasswordSettingsList[5].value":{positiveInteger:!0,max:20,required:!0,min:function(){if($("#passwordSettings5").is(":not(:checked)"))return 0;var e=0;return $("#passwordSettings6").is(":checked")&&(e+=$.isNumeric($("#passwordSettings6Value").val())?parseInt($("#passwordSettings6Value").val()):0),$("#passwordSettings7").is(":checked")&&(e+=$.isNumeric($("#passwordSettings7Value").val())?parseInt($("#passwordSettings7Value").val()):0),e>1?e:1}},"databasePasswordSettingsList[6].value":{positiveInteger:!0,max:20,min:1,required:!0},"databasePasswordSettingsList[7].value":{positiveInteger:!0,max:20,min:1,required:!0},"databasePasswordSettingsList[8].value":{positiveInteger:!0,max:20,min:1,required:!0},"databasePasswordSettingsList[9].value":{positiveInteger:!0,max:20,required:!0},"databasePasswordSettingsList[10].value":{positiveInteger:!0,max:24,required:!0}},messages:{"databasePasswordSettingsList[0].value":getErrorMessage("field.password.settings.999"),"databasePasswordSettingsList[1].value":getErrorMessage("field.password.settings.999"),"databasePasswordSettingsList[2].value":getErrorMessage("field.password.settings.99999.reset"),"databasePasswordSettingsList[3].value":getErrorMessage("field.password.settings.99999.lock"),"databasePasswordSettingsList[4].value":{positiveInteger:getErrorMessage("field.password.settings.length"),max:getErrorMessage("field.password.settings.length"),min:getErrorMessage("field.password.settings.length")},"databasePasswordSettingsList[5].value":{positiveInteger:getErrorMessage("field.password.settings.alphabetic"),max:getErrorMessage("field.password.settings.alphabetic"),min:getErrorMessage("field.password.settings.alphabetic")},"databasePasswordSettingsList[6].value":getErrorMessage("field.password.settings.20.1"),"databasePasswordSettingsList[7].value":getErrorMessage("field.password.settings.20.1"),"databasePasswordSettingsList[8].value":getErrorMessage("field.password.settings.20.1"),"databasePasswordSettingsList[9].value":getErrorMessage("field.password.settings.20"),"databasePasswordSettingsList[10].value":getErrorMessage("field.password.settings.24")}}))}(e);var n=e.find("#passwordSettingsModal");e.find("#savePasswordSettings").on("click",function(){var t=e.find("#passwordSettingsForm");return!!t.valid()&&($(this).hasClass("pending")||function(e,a,t,n){n.addClass("pending"),$.ajax({url:"care-coordination/organizations/password-settings/"+a,type:"POST",data:e.serialize(),beforeSend:function(e){S.csrf(e)}}).success(function(e){n.removeClass("pending"),t.modal("hide")}).fail(function(e){S.onAjaxError(e,function(){alert(e.responseText),n.removeClass("pending")})})}(t,a,n,$(this)),!1)}),$("[id^=passwordSettings] :checkbox").styler(),$("[id^=passwordSettings] :checkbox").change(function(){var e=$(this).attr("id")+"Value";$("#"+e).prop("readonly",!this.checked)}),e.find("#passwordSettingsModal").modal("show"),e.find("#passwordSettingsModal").on("hidden.bs.modal",function(){$(this).remove()})})}function p(e,t,n,c){if(!n.hasClass("pending"))return n.addClass("pending"),$.ajax({url:"care-coordination/templates/organizations/"+t,beforeSend:function(){$(".ajaxLoader").removeClass("hidden")},complete:function(){$(".ajaxLoader").addClass("hidden")}}).success(function(p){function m(e){var a=0,t=$(".organizationWizardContent"),n=$(".table-div");parseInt(e.css("height"),10)>=220?(n&&(a=null!=n.height()?n.height():0),t.css("paddingBottom",25+parseInt(e.css("height"),10)-a+"px")):t.css("paddingBottom",25+parseInt(e.css("height"),10)+"px"),"none"===e.css("display")&&t.css("paddingBottom","25px")}function k(e,a){Array.from(e).forEach(function(e){var t=$(e).children(":first").children(":first");"No networks found"===$(e).text()&&a&&$(e).remove(),null!==t&&t.html($(e).text().fontcolor("#333333")),$(e).show()})}function w(e,a){var t=$("#searchInput");return Array.from(e).forEach(function(e){($(e).hasClass("selected")||"I'll choose my insurance later"===$(e).text())&&($(e).hide(),t.val()&&a.removeClass("search-icon").addClass("cancel-search-icon"))}),e}function b(){var e=$("#tableElement"),a=o($("#selectSearch"));0!==a.length?($.ajax({type:"GET",contentType:"application/json",url:"care-coordination/templates/organizations/"+t+"/networks/"+a,dataType:"html"}).success(function(a){e.empty(),e.append(a);var t=e.find(".spicker");t.selectpicker(),t.on("changed.bs.select",S.noneOptionHandler),t.on("changed.bs.select",S.allOptionHandler),e.find("select.spicker").each(function(){var e=$(this);e.selectpicker("val")||e.selectpicker("val",0)})}),e.css("display","block"),e.find(".selectedPlan").find(".filter-option").addClass("network-table-filter-option")):(e.css("display","none"),e.empty())}function y(e){var a=$(e.target),t=$("#tableElement"),n=$("#selectSearch"),i=n.siblings(".dropdown-menu"),r=n.prev().find("ul").find("li"),s=$("#searchIcon"),o=$("#searchInput");if(t.find(".selected-plan").find(".filter-option").addClass("network-table-filter-option"),a.closest("button").parent().hasClass("selected-plan")){var l=a.closest("button").next();l.addClass("plan_select_button_dropdown"),l.find("ul").find("li").find("a").addClass("ellipsis-text"),t.find(".selectedPlan").find(".filter-option").addClass("network-table-filter-option")}else a.is(i)||a.is(o)||a.is(s)||a.parent().hasClass("modal-table-row")||(s.removeClass("cancel-search-icon").addClass("search-icon"),o.val(""),i.css("display","none"),b()),m(i),t.find(".selectedPlan").find(".filter-option").addClass("network-table-filter-option");t.find(".selected-plan").find(".filter-option").addClass("network-table-filter-option"),w(r,s)}e.empty(),e.append(p);!function(e,a,t){var n=e.find("#orgForm");n.validate(new ExchangeApp.utils.wgt.Validation({ignore:t?[]:$.validator.defaults.ignore,scrollToFirstInvalid:!0,container:e.find("#createOrgModal"),rules:{name:{required:!0,maxlength:100,minlength:3,remote:{url:C,type:"GET",data:{name:n.find("#name").val(),id:a}}},loginCompanyId:{required:!0,maxlength:10,regexp:/^[^//]+$/,remote:{url:C,type:"GET",data:{loginCompanyId:n.find("#loginCompanyId").val(),id:a}}},oid:{required:!0,maxlength:30,remote:{url:C,type:"GET",data:{oid:n.find("#oid").val(),id:a}}},email:{required:!0,maxlength:100,email:!0},phone:{required:!0,maxlength:16,phone:!0},street:{minlength:2,maxlength:200,requiredIf:{conditionFunction:r.bind(n,n)}},city:{minlength:2,maxlength:100,requiredIf:{conditionFunction:r.bind(n,n)}},stateId:{requiredIf:{conditionFunction:r.bind(n,n)}},postalCode:{zipcodeUS:!0,requiredIf:{conditionFunction:r.bind(n,n)}},"marketplace.servicesSummaryDescription":{pattern:"[0-9a-zA-Z !\"#$%&'â€™()*+,\\s\\-./:;<=>?@\\\\[\\]^_`{|}~]*"},"marketplace.appointmentsEmail":{maxlength:150,email:!0},"marketplace.appointmentsSecureEmail":{maxlength:150,email:!0,requiredIf:{conditionFunction:function(e){return e.find("#allowAppointments").is(":checked")}.bind(n,n)}},logo:{fileIsPicture:!0,filesize:1048576,fileRatio:[1.5,5]}},messages:{name:{required:getErrorMessage("field.empty"),remote:"Name of Organization should be unique"},loginCompanyId:{required:getErrorMessage("field.empty"),remote:"Company ID should be unique",regexp:"Slash is forbidden"},oid:{required:getErrorMessage("field.empty"),remote:"Organization OID should be unique"},street:{requiredIfNot:"All address fields should be filled, if at least one of the fields is not empty",requiredIf:"All address fields should be filled, if organization is discoverable in Marketplace"},phone:{phone:getErrorMessage("field.phone.format")},city:{requiredIfNot:"All address fields should be filled, if at least one of the fields is not empty",requiredIf:"All address fields should be filled, if organization is discoverable in Marketplace"},stateId:{requiredIfNot:"All address fields should be filled, if at least one of the fields is not empty",requiredIf:"All address fields should be filled, if organization is discoverable in Marketplace"},postalCode:{requiredIfNot:"All address fields should be filled, if at least one of the fields is not empty",requiredIf:"All address fields should be filled, if organization is discoverable in Marketplace"},"marketplace.servicesSummaryDescription":{pattern:"Invalid format. Allowed: letters, numbers, space and special symbols"},"marketplace.appointmentsSecureEmail":{requiredIf:$.validator.messages.required},logo:{fileIsPicture:"File should be of picture format",filesize:"Maximum file size is 1 MB",fileRatio:"Image ratio should be between 1.5:1 and 5:1"}}}))}(e,t,!0);!function(e,t){var n=a(),r=$("#createOrgWzd");(t===z.ADD||t===z.EDIT&&!h())&&r.tabs({disabled:[1,2]});(function(e){var a=$("#selectSearch");e===z.ADD&&(O=new Map,$.each(a.find("option"),function(e,a){$(a).prop("selected",!1)}))})(t),n.widgets.createOrgWizard=function(e,a){return E.wizard(e,"",a)}(e,{wizardId:"createOrgWzd",tabClass:"nav nav-tabs",onNext:function(e,a,t){switch(t){case 1:return h()&&(r.tabs({active:t}),r.tabs("enable",t)),h();case 2:return v()&&(r.tabs({active:t}),r.tabs("enable",t)),v();default:return!1}},onFinish:function(e,a,t){return!0},onPrevious:function(e,a,t){return r.tabs({active:t}),!0},onTabClick:function(e,a,t,n){if(!(n<=t))switch(n){case 1:return h()?r.tabs({enable:n,active:n}):r.tabs({disabled:[1,2],active:t}),h();case 2:return v()?r.tabs({enable:n,active:n}):r.tabs({disabled:[2],active:t}),v();default:return!1}},onTabShow:function(e,a,t){return t=t<0?0:t,r.tabs({active:t}),g(t),!0},nextSelector:i(".wzBtns .next"),previousSelector:i(".wzBtns .previous"),finishSelector:i(".wzBtns .finish")}),function(e){i(".nav>li").removeClass("active"),3!==e&&i(".nav>li:eq("+e+")").addClass("active");i(".nav>li:lt("+e+")").addClass("wz-done"),i(".tab-pane").removeClass("active"),i(".tab-pane:eq("+e+")").addClass("active"),3===e&&i(".tab-pane:eq(2)").addClass("active");g(e)}(n.widgets.createOrgWizard.dataset.activeStep),i(".wzBtns .next").removeClass("disabled")}(e,c);var I=e.find("#createOrgModal"),x=e.find("#createBtn,#createBtn2"),A=e.find("#allowAppointments"),T=e.find("#orgAppointmentsSecureEmail"),L=e.find("#orgAppointmentsSecureEmailDiv"),P=e.find("label[for='orgAppointmentsSecureEmail']"),M=e.find("#orgConfirmVisibilityInMarketplace"),q=I.find(":input.addressPart"),D=I.find("label.addressPart");x.on("click",function(){var n=e.find("#orgForm");if(!function(e){var a=!1;return e.find(".affiliatedDetails").not(".hidden").each(function(){var e=$(this).find("select.communitySelect");null==e.selectpicker("val")&&(e.parent().parent().addClass("has-warning"),a=!0);var t=$(this).find("select.affOrgSelect");""===t.selectpicker("val")&&(t.parent().parent().addClass("has-warning"),a=!0);var n=$(this).find("select.affCommunitySelect");if(null==n.selectpicker("val")&&(n.parent().parent().addClass("has-warning"),a=!0),a)return!1}),e.valid()&&!a}(n)){if($("#affiliateRelationshipTab").has(".has-warning").length<=-[0]){var i=$("#legalInfoTab").has(".has-warning").length<=-0,r=$("#marketplaceTab").has(".has-warning").length<=-0;i?r||$("#marketplaceHeadLnk").click():$("#legalInfoHeadLnk").click()}return!1}return $(this).hasClass("pending")||function(e,t,n,i){i.addClass("pending");var r="care-coordination/organizations",s="POST";t&&(r+="/"+t,s="PUT"),e.find("#orgCompanyCode").removeAttr("disabled"),e.find("#orgOid").removeAttr("disabled");var o=e.serializeJSON(),l=o.logoChanged,c=o.logoRemoved;delete o.logoChanged,delete o.logoRemoved,o.affiliatedDetails=[],$(".affiliatedDetails").not(".hidden").each(function(){var e={};e.communityIds=$(this).find("select.communitySelect").selectpicker("val"),e.affOrgId=$(this).find("select.affOrgSelect").val(),e.affCommunitiesIds=$(this).find("select.affCommunitySelect").selectpicker("val"),o.affiliatedDetails.push(e)}),delete o._affiliatedDetails;var p=function(e){a().widgets.organizationList.api().ajax.reload(),n.modal("hide"),u(e),ExchangeApp.managers.EventManager.publish("org_list_changed")};delete(o=d(o))._csrf,$.ajax({url:r,type:s,enctype:"multipart/form-data",contentType:"application/json",dataType:"json",data:JSON.stringify(o),beforeSend:function(e){S.csrf(e)}}).success(function(e){if(ExchangeApp.modules.Header.addOptionToOrganizationChooserIfAbsent(e.id,e.name),1==c){var a="care-coordination/organizations/"+e.id+"/logo";$.ajax({url:a,type:"DELETE",cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(e){S.csrf(e)}}).success(function(a){p(e.id)}).fail(function(a){S.onAjaxError(a,function(){console.log(a),alert("There were problems deleting logo"),p(e.id)})})}else if(1==l){var t="care-coordination/organizations/"+e.id+"/logo",n=$("#logoOrgInput")[0].files[0],i=new FormData;i.append("logo",n),$.ajax({url:t,type:"POST",data:i,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(e){S.csrf(e)}}).success(function(a){p(e.id)}).fail(function(a,t){S.onAjaxError(a,function(){console.log(a,t),alert("There were problems updating logo"),p(e.id)})})}else p(e.id)}).fail(function(e){S.onAjaxError(e,function(){alert(e.responseText),i.removeClass("pending")})})}(n,t,I,$(this)),!1});var F=P.text();A.change(function(){this.checked?P.text(F+"*"):(P.text(F),""===T.val()&&(T.removeClass("error"),L.removeClass("has-warning")))}),A.is(":checked")&&P.text(F+"*"),M.change(function(){this.checked?D.find("span").show():""===q.val()&&(D.find("span").hide(),D.parent().removeClass("has-warning"))}),(""!==q.val()||M.is(":checked"))&&D.find("span").show(),q.change(function(){if($(this).valid()){var a;if(""===$(this).val()){a=""===q.not(this).val();var t=e.find("#orgForm");a&&!r(t)&&D.find("span").hide()}else{var n=q.not(this).map(function(){return $(this).val()});a=-1===$.inArray("",n)&&q.not(this).valid()}a&&D.parent().removeClass("has-warning")}$(this).val().length>1&&D.find("span").show()}),e.find("#createOrgModal").modal("show"),e.find("#createOrgModal").on("hidden.bs.modal",function(){$(this).remove()}),$("#oidHelp").popover(),$("#companyIdHelp").popover(),$("#companyLogoHelp").popover(),$("#confirmCompanyHelp").popover(),$("#affiliatedOrgHelp").popover(),$("#searchInput").on({keyup:function(){var e=$("#searchInput").val().toLowerCase(),a=$("#selectSearch").prev(),t=a.find("ul").find("li"),n=$("#searchIcon");if(a.css("display","block"),n.removeClass("cancel-search-icon").addClass("search-icon"),k(t,!1),null!==e&&""!==e){n.removeClass("search-icon").addClass("cancel-search-icon"),Array.from(t).forEach(function(a){var t=$(a).children(":first").children(":first");if($(a).text().toLowerCase().indexOf(e)<0&&$(a).hide(),null!==t){var n=t.text().toLowerCase().indexOf(e);t.html($(a).text().substring(0,n)+$(a).text().substring(n,n+e.length).fontcolor("#454F81")+$(a).text().substring(n+e.length))}}),t=w(t,n);var i=a.find("ul"),r=i.find("li").filter(":hidden"),s=document.createElement("li");r.length===t.length?($(s).text("No networks found"),i.append(s)):"No networks found"===i.children(":last").text()&&Array.from(i.children()).map(function(e){"No networks found"===$(e).text()&&$(e).remove()})}else k(t,!0),w(t,n);m(a)},click:function(){var e=$("#selectSearch").prev(),a=e.find("ul").find("li");m(e),e.css("display","block"),a=w(a);var t=function(e){$(e.target).is("#searchInput")||(y(e),$("#createOrgModal").off("click",t))};$("#createOrgModal").on("click",t)},blur:function(){var e=$("#selectSearch"),a=e.prev().find("ul").find("li");e.change(function(){$("#tableElement").css("display","none")}),w(a,$("#searchIcon"))}}),$("#tableElement").on("click",".remove-button",function(){var e=$(this).closest("tr").data("network-name"),a=$("#selectSearch"),t=a.prev().find("ul").find("li"),n=$(this);$.each(a.find(":selected"),function(a,t){$(t).text()===e&&$(t).prop("selected",!1)}),$.each(t,function(a,t){$(t).text()===e&&($(t).removeClass("selected"),$(t).show())}),$(this).closest("tr").remove(),0===n.find("td").length&&n.empty()}),$("#searchIcon").on("click",function(){var e=$("#selectSearch").prev();if($(this).hasClass("cancel-search-icon")){var a=e.find("ul").find("li");$("#searchInput").val(""),k(a,!0),w(a,$(this)),$(this).removeClass("cancel-search-icon").addClass("search-icon")}e.css("display","block"),m(e);var t=function(e){$(e.target).is("#searchIcon")||(y(e),$("#createOrgModal").off("click",t))};$("#createOrgModal").on("click",t)}),b(),i(":file").each(function(e,a){var t=$(a).attr("data-buttonText"),n="true"==$(a).attr("data-icon"),i=$(a).attr("data-placeholder");$(a).filestyle({icon:n,buttonText:t}),$(a).filestyle("placeholder",i||"File Not Chosen");var r=$('<a href="#" class="cancel-icon" id="removeLogo"></a>');$(".input-group input").after(r),"File Not Chosen"!==i&&""!==i&&$(".cancel-icon").css({paddingTop:"3px",opacity:1,zIndex:3}),$(a).on("change",function(){$(".cancel-icon").css({paddingTop:"3px",opacity:1,zIndex:3}),$("#logoChanged").val(1),$("#logoRemoved").val(0)}),r.on("click",function(){return $("#logoRemoved").val(1),$(a).filestyle("clear"),$(a).filestyle("placeholder","File Not Chosen"),$(a).parents(".form-group").removeClass("has-warning"),$(a).siblings(".bootstrap-filestyle").tooltip("destroy"),$(this).css({paddingTop:0,opacity:0,zIndex:0}),!1})}),$("input:checkbox").styler(),l($("#orgPrimaryFocus"));var j=e.find("select.spicker");l($("#orgPrimaryFocus")),j.selectpicker(),j.on("changed.bs.select",S.noneOptionHandler),j.on("changed.bs.select",S.allOptionHandler),s("#orgAgeGroupsAccepted"),s("#orgAncillaryServices"),s("#orgEmergencyServices"),$.each(j.selectpicker(),function(e,a){$.each(a,function(e,a){-1!=$(a).val()&&"none"===$(a).text().toLowerCase()?($(a).parent().prev().find("ul").children().eq(e).hide(),$(a).prop("selected")&&$(a).parent().prev().find("ul").children().filter(function(e,a){return"none"===$(a).text().toLowerCase()&&"none"!==$(a).css("display")}).addClass("selected")):$(a).parent().prev().find("li").filter(function(e,a){return"none"!==$(a).text().toLowerCase()&&"none"!==$(a).css("display")}).on("click",function(e){"none"!==$(e.target).text().toLowerCase()&&($(a).parent().find(":selected").filter(function(e,a){return"none"===$(a).text().toLowerCase()}).prop("selected",!1),$(a).parent().prev().find("li").filter(function(e,a){return"none"===$(a).text().toLowerCase()&&"none"!==$(a).css("display")}).removeClass("selected"),$(a).parent().prev().prev().find(".filter-option").text().toLowerCase().replace("none, ",""))})})});var N=e.find("select.affOrgSelect");N.each(function(){N.not(this).find("option[value='"+$(this).val()+"']").hide()}),N.change(f),e.find(".affiliatedDetails").not(".hidden").each(function(){var e=$(this);$(this).find(".closeAffiliatedOrgsButton").on("click",function(){e.remove()})});e.find(".affiliatedOrgsButton").on("click",function(){var a=e.find(".affiliatedDetails.hidden").clone();a.removeClass("hidden");var t=a.find(".relationship-header"),n=t.html()+" #"+(e.find(".affiliatedDetails").filter(":visible").size()+1);t.html(n),e.find("#affiliateRelationshipTab").append(a);var i=a.find(".spicker-template");i.removeClass("spicker-template").addClass("spicker"),i.selectpicker(),i.on("changed.bs.select",S.allOptionHandler),a.find(".closeAffiliatedOrgsButton").on("click",function(){a.remove()});a.find("select.affOrgSelect").change(f)}),n.removeClass("pending")}).fail(function(e,a){console.log(e,a),n.removeClass("pending"),alert("Internal server error. Please contact administrator.")}),!1}function f(){var e=$(this).closest(".affiliatedDetails"),a=$("select.affOrgSelect");a.find("option").show(),a.each(function(){a.not(this).find("option[value='"+$(this).val()+"']").hide()}),$.ajax({url:"care-coordination/communities/byorg/"+$(this).val(),type:"GET"}).success(function(a){var t=e.find("select.affCommunitySelect");t.find("option").remove(),t.append('<option value="0">All Communities</option>'),$.each(a.content,function(e,a){t.append('<option value="'+a.id+'">'+a.name+"</option>")}),t.selectpicker("refresh")}).fail(function(e){$("#formError").text(e.responseText)})}function u(e){$.ajax("care-coordination/organizations/details/"+e).success(void 0,function(t){if(!i("#organizationContent").is(":hidden")||!i("#communityDetailsContent").is(":hidden")){i("#organizationContent").hide(),i("#organizationDetailsContent").hide(),i("#organizationDetailsContent").empty(),i("#organizationDetailsContent").append(t),i("#organizationDetailsContent").show(),S.find(a().$html,"",".backToOrganizationsList").on("click",function(){i("#organizationDetailsContent").hide(),i("#organizationContent").show()});S.find(a().$html,"","#passwordSettings").on("click",function(){c(i("#passwordSettingsContainer"),e)});if(S.find(a().$html,"","#editOrganization").on("click",function(){p(i("#createOrganizationContainer"),e,$(this),"edit")}),ExchangeApp.modules.Header.setCurrentOrg(e),!ExchangeApp.modules.CareCoordinationCommunities){ExchangeApp.managers.ModuleManager.invoke({module:{name:"CareCoordinationCommunities",fragment:{url:{template:"care-coordination/templates/communities"}}},initParents:!1,forceReload:void 0,asyncLoad:!0})}$("a[id^=communityDetailsLink]").each(function(a){var t=$(this),n=t.children("input").first().val();t.click(function(){ExchangeApp.modules.Header.setCurrentOrg(e),ExchangeApp.modules.Header.showCurrentOrg(),ExchangeApp.modules.CareCoordinationOrganizations.hide(),ExchangeApp.modules.CareCoordinationCommunities.show(),ExchangeApp.modules.CareCoordinationCommunities.showCommunityDetails(n,void 0,!1)})})}})}function m(){i("#createOrganizationContainer");a().widgets.organizationList=function(e){var t=a();return E.grid(t.$html,t.random,e)}({tableId:"organizationList",searchFormId:"orgFilterFrom",totalDisplayRows:25,colSettings:{createdAutomatically:{customRender:function(e){return e?"Yes":""}},name:{customRender:function(e,a,t){return"<a href='#' onclick='ExchangeApp.modules.CareCoordinationOrganizations.showOrgDetails("+t.id+");'>"+e+"</a>"}},communityCount:{customRender:function(e,a,t){return"<a href='#' onclick='ExchangeApp.modules.Header.setCurrentOrg("+t.id+"); ExchangeApp.modules.CareCoordination.routeToCommunityList(); return false;'>"+e+"</a>"}},affilatedCount:{customRender:function(e,a,t){return e||(e="0"),'<a href="#" id="affiliated-source-'+t.id+'" onclick="return false">'+e+"</a>"}}},order:[[0,"asc"]],callbacks:{rowCallback:function(e,a,t){!function(e,a){if(e&&a){var t=i("#affiliatedOrgsTemplate").clone(),n="affiliatedTemplate-"+e.id;t.attr("id",n);var r=t.children().clone();t.empty(),$.each(a,function(e,a){var n=r.clone();n.find("label").text(a.name),n.find("a").click(function(){u(a.id)}),t.append(n)}),t.removeClass("hidden"),$(e).popover({html:!0,content:t[0],trigger:"hover",placement:function(){return $(e).addClass("hasPopover"),"bottom"}}),$(e).on("show.bs.popover",function(){i(".popover").trigger("mouseout")}).on("shown.bs.popover",function(){i(".popover").on("mouseout",function(){$(this).is(":hover")||$(e).removeClass("hasPopover").popover("hide")})}).on("hide.bs.popover",function(){if($(this).hasClass("hasPopover"))return!1})}}($(e).find("#affiliated-source-"+a.id)[0],a.affiliatedOrgItems);$(e)},errorCallback:function(e){alert(e.responseText)},footerCallback:function(e,a,t,n,i){$(e).hide()}}}),a().widgets.organizationList.api().ajax.reload()}function g(e){i(".alert").remove(),i(".wzBtns .btn").addClass("hidden"),i([".legalInfoStep",".marketplaceStep",".affiliateRelationshipStep"][e]).removeClass("hidden")}function h(){var e=$("#orgForm").valid(),a=$("#legalInfoTab").has(".has-warning").length<=0;return e||(L($("#marketplaceTab")),L($("#affiliateRelationshipTab"))),!!e||a}function v(){var e=$("#orgForm").valid(),a=$("#marketplaceTab").has(".has-warning").length<=0;return e||L($("#affiliateRelationshipTab")),!!e||a}var k,w={},b={template:"care-coordination/templates/organizations"},C="care-coordination/organizations/isUnique",y="organizationsTabContent",I={reloadNeeded:!1},x=ExchangeApp.routers.ModuleRouter,S=ExchangeApp.utils.module,E=ExchangeApp.utils.wgt,A=ExchangeApp.loaders.FragmentLoader.init("careCoordinationOrganizations"),z=Object.freeze({ADD:"create",EDIT:"edit"}),O=new Map,T=null;ServiceProvider.getService("MarketplaceService").then(function(e){T=e}).fail(function(e){alert(e)});var L=function(e){var a=e.find(".has-warning");a.removeClass("has-warning"),a.find(":input").tooltip("destroy").removeAttr("data-validated")};return{init:function(t,n){b=t,k=n,this.loadFragment({onFragmentLoaded:function(){e()},onResourcesLoaded:function(){var e=a();e.widgets={},m(),this.setEvents(),e.inited=!0,this.render(),this.show()}})},update:function(e){b=e},getFragment:function(e){return w[n(e,{params:!0})]},isFragmentInited:function(e){var a=this.getFragment(e);return a&&a.inited},loadFragment:function(e){var a=this;A.load({url:b,callbacks:{onFragmentLoaded:function(t){I.reloadNeeded=!1;var i=$(t).find("#content").children(),r=n(b,{params:!0});w[r]={$html:i,url:S.clone(b)},e.onFragmentLoaded.apply(a)},onResourcesLoaded:function(){e.onResourcesLoaded.apply(a),i("input").styler()}}})},render:function(){var e=a().$html;t().empty(),t().append(e)},hide:function(){t().hide(),$("#content").addClass("loading")},show:function(){0==$("#content").find(".tab-pane:visible").length&&($.each($("#care-coordination").find(".nav li"),function(){$(this).removeClass("active")}),$('a[data-target^="#'+y+'"]').parent("li").addClass("active"),t().show()),$("#content").removeClass("loading")},setEvents:function(){return i("#createOrganization").on("click",function(){p(i("#createOrganizationContainer"),0,$(this),"create")}),i("#searchOrganization").on("click",function(){return a().widgets.organizationList.api().ajax.reload(),!1}),!1},reloadNeeded:function(){return I.reloadNeeded},getParentModule:function(){return k},showOrgDetails:function(e){u(e)}}}();