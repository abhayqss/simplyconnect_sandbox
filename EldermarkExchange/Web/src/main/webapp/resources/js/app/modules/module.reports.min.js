ExchangeApp.modules.Reports=function(){function e(){t().random=c.rand(),function(e,n){var r=t(),a=e||r.$html,o=n||r.random;a=c.randomize(a,o,!1)}(),function(e,n){var r=t();r.ajaxMap||(r.ajaxMap={});var o=e||r.$html,d=n||r.random,i=c.findAjaxUrls(o,d);$.each(i,function(e,t){r.ajaxMap[a(t,{params:!0})]=t}),c.find(o,d,'[data-ajax-load="true"]').on("click",function(){var e=$(this).attr("data-ajax-url-tmpl"),t=$(this).attr("data-ajax-url-vars"),n=$(this).attr("data-ajax-url-params"),r=c.getUrl(e,t,n);return s.route(r),!1}),c.find(o,d,'[data-ajax-anchor="true"]').on("click",function(){var e=$($(this).attr("href"));return e.length&&$("html, body").animate({scrollTop:e.offset().top},200),!1})}()}function t(){return d[a(i,{params:!0})]}function n(){return a(i,{params:!0}).replace(/[/&\?=]/g,"_")}function r(){return $(document.getElementById(n()))}function a(e,t){return c.stringifyUrl(e,t)}function o(e){var n=t();return c.find(n.$html,n.random,e)}var d={},i={template:"reports"},l={reloadNeeded:!1},s=ExchangeApp.routers.ModuleRouter,c=ExchangeApp.utils.module,u=(ExchangeApp.utils.wgt,ExchangeApp.loaders.FragmentLoader.init("reports"));return{init:function(n){i=n,this.renderHolder(),this.loadFragment({onFragmentLoaded:function(){e()},onResourcesLoaded:function(){var e=t();e.widgets={},function(){var e=o("#baseAddr").val(),t=o("#SSRSUrl").val();$.ajax({url:"reports/get-menu/"}).success(function(n){o("#reportsMenu").treeview({data:n,showBorder:!1,borderColor:"white",selectedColor:"#009288",selectedBackColor:"#ffffff",onhoverColor:"#ffffff",showIcon:!1,enableLinks:!1,expandCollapseIconPosition:"right",expandIcon:"glyphicon glyphicon-triangle-right",collapseIcon:"glyphicon glyphicon-triangle-bottom",onNodeSelected:function(n,r){if(r.href){var a,d=o("#reportFrame");"kyubit"==r.server?(a=e+"/Forms/Dashboard.aspx?DashboardID="+r.href.substr(1)+"&align=left",d.attr("src",a)):(a=t+":444/ReportServer/Pages/ReportViewer.aspx"+r.href+"&rs:Command=Render&rc:stylesheet=HideToolBar",d.attr("src",a))}}})}).fail(function(){alert("Internal server error. Please contact administrator.")})}(),function(){var e=document.createElement("iframe");e.name="kyubit_login_iframe",e.setAttribute("style","width: 0;height:0;overflow: hidden"),document.body.appendChild(e);var t=o("#loginForm").clone();document.body.appendChild(t.get(0)),e.onload=function(){e.remove(),o("#loginForm").remove(),o("#reportsMenu").treeview("selectNode",[1])},t.submit()}(),this.render(),this.show(),e.inited=!0,this.loaded()}})},update:function(e){},loadFragment:function(e){var t=this;u.load({url:i,callbacks:{onFragmentLoaded:function(n){l.reloadNeeded=!1;var r=$(n).find("#content .markup-frg"),o=a(i,{params:!0});d[o]={$html:r,url:c.clone(i)},e.onFragmentLoaded.apply(t)},onResourcesLoaded:function(){e.onResourcesLoaded.apply(t)}}})},loaded:function(){$.each($(".baseHeader .ldr-head-lnk.active"),function(){$(this).removeClass("active"),$(this).removeClass("bottom")});var e=$(".baseHeader .ldr-head-lnk.reportsLnk");e.addClass("active"),e.addClass("bottom")},render:function(){var e=t().$html;r().empty(),r().append(e)},renderHolder:function(){if(!document.getElementById(n())){var e=$("<div/>");e.attr("id",n()),e.hide(),$("#content").append(e)}},hide:function(){r().hide(),$("#content").addClass("loading")},show:function(){0==$("#content > div:visible").length&&r().show(),$("#content").removeClass("loading")},getFragment:function(e){return d[a(e,{params:!0})]},isFragmentInited:function(e){var t=this.getFragment(e);return t&&t.inited},reloadNeeded:function(){return l.reloadNeeded}}}();