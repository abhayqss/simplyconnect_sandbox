ExchangeApp.modules.CareCoordinationNewEvent=function(){function e(){t().random=m.rand(),function(e,n){var r=t(),a=e||r.$html,i=n||r.random;a=m.randomize(a,i,!1)}(),function(e,n){var a=t();a.ajaxMap||(a.ajaxMap={});var i=e||a.$html,s=n||a.random,d=m.findAjaxUrls(i,s);$.each(d,function(e,t){a.ajaxMap[r(t,{params:!0})]=t}),m.find(i,s,'[data-ajax-load="true"]').on("click",function(){var e=$(this).attr("data-ajax-url-tmpl"),t=$(this).attr("data-ajax-url-vars"),n=$(this).attr("data-ajax-url-params"),r=m.getUrl(e,t,n);return g.route(r),!1}),m.find(i,s,'[data-ajax-anchor="true"]').on("click",function(){var e=$($(this).attr("href"));return e.length&&$("html, body").animate({scrollTop:e.offset().top},200),!1})}()}function t(){return o[r(l,{params:!0})]}function n(){return $('[id^="'+u+'"]')}function r(e,t){return m.stringifyUrl(e,t)}function a(e){var n=t();return m.find(n.$html,n.random,e)}function i(){a(".alert").remove()}function s(e,n){a('[id="'+e+t().random+'"]').on("change",function(e){$(this).context.checked?$('[id="'+n+t().random+'"]').show():$('[id="'+n+t().random+'"]').hide()})}var d,o={},l={template:"care-coordination/event-new"},u="newEventContent",c={reloadNeeded:!1},g=ExchangeApp.routers.ModuleRouter,m=ExchangeApp.utils.module,h=(ExchangeApp.utils.wgt,ExchangeApp.loaders.FragmentLoader.init("careCoordinationNewEvent"));return{init:function(n,r){l=n,d=r,this.loadFragment({onFragmentLoaded:function(){e()},onResourcesLoaded:function(){var e=t();e.widgets={},this.setEvents(),e.inited=!0,this.render()}})},update:function(e){l=e},getFragment:function(e){return o[r(e,{params:!0})]},isFragmentInited:function(e){var t=this.getFragment(e);return t&&t.inited},loadFragment:function(e){var t=this;h.load({url:l,callbacks:{onFragmentLoaded:function(n){c.reloadNeeded=!1;var a=$(n).find("#content").children(),i=r(l,{params:!0});o[i]={$html:a,url:m.clone(l)},e.onFragmentLoaded.apply(t)},onResourcesLoaded:function(){e.onResourcesLoaded.apply(t),a("#newEventForm").validate(new ExchangeApp.utils.wgt.Validation({rules:{"employee.roleId":{required:!0},"manager.firstName":{required:!0,minlength:2,maxlength:128},"manager.lastName":{required:!0,minlength:2,maxlength:128},"manager.email":{required:!1,email:!0},"manager.phone":{required:!1,phone:!0},"responsible.firstName":{required:!0,minlength:2,maxlength:128},"responsible.lastName":{required:!0,minlength:2,maxlength:128},"responsible.address.street":{required:!0,minlength:2,maxlength:255},"responsible.address.city":{required:!0,minlength:2,maxlength:128},"responsible.address.state":{required:!0},"responsible.address.zip":{required:!0,positiveInteger:!0,lengthEqual:5},"eventDetails.eventDatetime":{required:!0},"eventDetails.followUpDetails":{required:!0,maxlength:5e3},"treatingPhysician.firstName":{required:!0,minlength:2,maxlength:128},"treatingPhysician.lastName":{required:!0,minlength:2,maxlength:128},"treatingPhysician.address.street":{required:!0,minlength:2,maxlength:255},"treatingPhysician.address.city":{required:!0,minlength:2,maxlength:128},"treatingPhysician.address.state":{required:!0},"treatingPhysician.address.zip":{required:!0,positiveInteger:!0,lengthEqual:5},"treatingPhysician.phone":{required:!1,phone:!0},"treatingHospital.name":{required:!0,minlength:2,maxlength:300},"treatingHospital.address.street":{required:!0,minlength:2,maxlength:255},"treatingHospital.address.city":{required:!0,minlength:2,maxlength:128},"treatingHospital.address.state":{required:!0},"treatingHospital.address.zip":{required:!0,positiveInteger:!0,lengthEqual:5},"treatingHospital.phone":{required:!1,phone:!0}},messages:{"manager.firstName":{required:getErrorMessage("field.empty")},"manager.lastName":{required:getErrorMessage("field.empty")},gender:{required:getErrorMessage("field.empty")},dateOfBirth:{dateExp:getErrorMessage("field.dateFormat"),required:getErrorMessage("field.empty")},ssn:{integer:getErrorMessage("field.integer"),lengthEqual:getErrorMessage("field.lengthEqual.4"),required:getErrorMessage("field.empty")},phone:{phone:getErrorMessage("field.phone.format")},state:{stateUS:getErrorMessage("field.state")}}})),a("input").styler()}}})},render:function(){var e=t().$html;n().empty(),n().append(e)},hide:function(){n().hide()},show:function(){$('a[data-target^="#'+u+'"]').parent("li").addClass("active"),n().show()},setEvents:function(){return s("includeManager","includeManagerContent"),s("includeResponsible","includeResponsibleContent"),s("responsible.includeAddress","includeResponsibleAddressContent"),s("eventDetails.followUpExpected","followUpDetailsContent"),s("includeTreatingPhysician","includeTreatingPhysicianContent"),s("treatingPhysician.includeAddress","includeTreatingPhysicianAddressContent"),s("includeHospital","includeHospitalContent"),s("treatingHospital.includeAddress","includeHospitalAddressContent"),s("includeResponsible","includeResponsibleContent"),a('[id="eventDetails.eventDatetime'+t().random+'"]').datetimepicker({defaultDate:new Date,format:"YYYY-MM-DD hh:mm A"}),a("#clear").on("click",function(){return a("#newEventForm").clearForm(),!1}),a("#submit").on("click",function(){var e=a("#newEventForm");return!!e.valid()&&($.ajax({url:e.attr("action"),data:new FormData(e[0]),type:"POST",enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(e){m.csrf(e)},success:function(e){i(),alert("Event has been successfully created")},error:function(e){m.onAjaxError(e,function(){i(),t().state.step.keyStore=!1,alert(e.responseText)})}}),!1)}),!1},reloadNeeded:function(){return c.reloadNeeded},getParentModule:function(){return d}}}();