var Grid=function(e){function t(e){if(!e)return"";return e>1048576?(e/1048576).toFixed(2)+" MB":e>1024?(e/1024).toFixed(2)+" KB":e+" B"}function a(){Widget.apply(this,arguments)}return a.prototype=Object.create(Widget.prototype),a.prototype.constructor=a,a.prototype.getDefaultProps=function(){return{hasHeader:!0,hasFooter:!0,columns:[],order:[],noDataText:"No results found",hasSorting:!0,hasPagination:!0,numbersLength:5,totalDisplayRows:25,getExtraAjaxData:function(){return null}}},a.prototype.getApi=function(){return this.$element.dataTable().api()},a.prototype.reload=function(){this.getApi().ajax.reload()},a.prototype.isEmpty=function(){return 0===this.getApi().data().length},a.prototype.componentDidMount=function(){var a=this,r=this.props;this.$element=e('[cmp-id="'+this.$$id+'"]'),this.$pagination=this.$element.find('[class *= "_paginate"]');var o=[],n=[],i=[],l=[],s=[];e.each(r.columns,function(a,r){var c={mDataProp:r.name,sName:r.name};switch(c.mRender=function(t){return function(t,a,r){var o="";if(t&&t.length>a){var n=t.split("\n");return e.each(n,function(t,n){var i=n.split(" ");e.each(i,function(e,t){if(t.length>a){for(var n="",i=new RegExp(".{1,"+r+"}","g"),l=t.match(i),s=0;s<l.length;s++)n+=l[s]+"<wbr>";o+=o.length?" "+n:n}else o+=o.length?" "+t:t}),o+="\n"}),o.length?o.slice(0,-1):t}return t}(t,15,10)},r.format){case"fake":i.push(r.name),l.push({orderable:!1,aTargets:[a],sName:r.name});break;case"ssn":c.mRender=function(e){return e?e.substring(0,3)+"-"+e.substring(3,5)+"-"+e.substring(5,9):""};break;case"checkbox":c.mRender=function(e,t,a){return"display"===t?'<input type="checkbox" class="editor-active">':e},c.className="checkbox-col",c.sWidth="10px",n.push(r.name),l.push({orderable:!1,aTargets:[a],sName:r.name});break;case"filesize":c.mRender=t;break;case"date":c.mRender=function(e){if(e){var t=new Date(e);return(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+t.getFullYear()}return""}}r.render&&(c.mRender=r.render),r.order&&s.push([a,r.order]),o.push(c)}),e.fn.DataTable.ext.pager.numbers_length=r.numbersLength;var c=location.pathname.match(/\/\w+/),d=c?c[0]:"",p=a.getDataSource(),u={sAjaxSource:p.ajax.url,destroy:!0,sAjaxDataProp:"content",aoColumns:o,aoColumnDefs:l,iDisplayLength:r.totalDisplayRows,iDisplayStart:0,bServerSide:!0,bProcessing:!0,iDeferLoading:r.isLoadingDeferred,sort:r.hasSorting,paginate:r.hasPagination,order:r.order,language:{paginate:{next:"<div/>",previous:"<div/>"},sZeroRecords:r.noDataText,sProcessing:"<img src='"+d+"/resources/images/ajax-loader.gif'>",sInfoEmpty:"",sInfoFiltered:"",sInfo:""},store:new ItemsStore,fnServerData:function(t,o,l){a.$pagination.hide();for(var s={},c=0;c<o.length;c++)s[o[c].name]=o[c].value;var d=s.iDisplayLength,u=s.iDisplayStart,h=0===u?u:u/d,f=[s.iSortCol_0,s.iSortCol_1,s.iSortCol_2,s.iSortCol_3,s.iSortCol_4,s.iSortCol_5,s.iSortCol_6,s.iSortCol_7],g=[s.sSortDir_0,s.sSortDir_1,s.sSortDir_2,s.sSortDir_3,s.sSortDir_4,s.sSortDir_5,s.sSortDir_6,s.sSortDir_7],m=[s["mDataProp_"+f[0]],s["mDataProp_"+f[1]],s["mDataProp_"+f[2]],s["mDataProp_"+f[3]],s["mDataProp_"+f[4]],s["mDataProp_"+f[5]],s["mDataProp_"+f[6]],s["mDataProp_"+f[7]]],b=t;-1!==d&&(b+=b.indexOf("?")>-1?"&":"?",b+="page="+h+"&size="+d);for(var c=0,D=m.length;c<D;c+=1)m[c]&&(b+=b.indexOf("?")>-1?"&":"?",b+="sort="+m[c],g[c]&&(b+=","+g[c]));var v=p.ajax.method;if(r.fetchServerData)r.fetchServerData(b,v,l);else{var y={dataType:"json",type:v,url:b,data:r.getExtraAjaxData(),beforeSend:function(t){var a=e("meta[name='_csrf']").attr("content"),r=e("meta[name='_csrf_header']").attr("content");t.setRequestHeader(r,a)},success:function(t){t.iTotalDisplayRecords=t.totalElements,e.each(t.content,function(t,a){e.each(n,function(e,t){a[t]=!1}),e.each(i,function(e,t){a[t]=!1})}),r.callbacks&&r.callbacks.successCallback&&r.callbacks.successCallback(t),l(t)},error:function(e){ExchangeApp.utils.module.onAjaxError(e,function(){e.iTotalDisplayRecords=0,e.content=[],r.callbacks&&r.callbacks.errorCallback&&r.callbacks.errorCallback(e),l(e)})}};a.$element.find("tbody tr").remove(),e.ajax(y)}}};e.extend(!0,u.language,r.language),e.extend(!0,u,r.scroll),e.extend(!0,u,r.callbacks),u.drawCallback=function(t){function r(e,t){t?u.store.addItem(e.id):u.store.removeItem(e.id)}function o(e,t){var a=e.find("input:checkbox");a&&(a.prop("checked",t),a.trigger("refresh"))}function n(e,t){e.toggleClass("selected",t)}function i(r,i,l){l?function(r,i){var l=e("<div/>");l.append(e("<span>"+i+"</span>")),l.attr("id","chosed-row-"+r),l.addClass("chosed-row");var s=e("<button></button>"),c=e('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>');s.append(c),s.on("click",function(){u.store.removeItem(r),l.remove(),a.$element.find("tbody tr").each(function(i,l){var s=e(l);a.getApi().row(i).data().id===r&&(o(s.find("input:checkbox"),!1),"multiple"===t.selectable.type&&n(s,!1))})}),l.append(s),e(".chose-rows-pnl").append(l)}(r,i):function(t){e(".chose-rows-pnl").find("#chosed-row-"+t).remove()}(r)}if(0==t.aoData.length?(e(t.nTHead).hide(),e(t.nTFoot).hide(),a.$pagination.hide()):(e(t.nTHead).show(),e(t.nTFoot).show(),a.$pagination.show()),t.selectable){a.$element.find("input:checkbox").styler(),u.store.items.length>0&&a.$element.find("tbody tr").each(function(r,i){var l=a.getApi().row(r).data();if(l&&u.store.hasItem(l.id)){var s=e(i);"multiple"===t.selectable.type&&n(s,!0),o(s,!0)}});a.$element.find("tbody").off("click").on("click","tr td",function(n){var l=e(n.currentTarget).parent(),s=a.getApi(),c=s.row(l).index(),d=s.row(c).data();if(void 0!==d){if(l.toggleClass("selected"),"multiple"===t.selectable.type){var p=l.hasClass("selected");r(d,p),o(l,p),t.selectable.boxForStore&&i(d.id,d[t.selectable.boxForStore.dataColumn],p)}"single"===t.selectable.type&&l.siblings().each(function(t,a){e(a).removeClass("selected")}),t.selectable.callback&&t.selectable.callback.call(a,l,d,c)}}),t.selectable.ignoreRowClicks&&a.$element.find("tbody").off("click"),a.$element.find("tbody tr").off("change").on("change","input:checkbox",function(o){var l=e(o.target).closest("tr"),s=a.getApi(),c=s.row(l).index(),d=s.row(c).data(),p=e(o.target).is(":checked");r(d,p),"multiple"===t.selectable.type&&n(l,p),t.selectable.boxForStore&&i(d,d[t.selectable.boxForStore.dataColumn],p),t.selectable.callback&&t.selectable.callback.call(a,l,d,c)})}t.callbacks&&t.callbacks.drawCallback&&t.callbacks.drawCallback.call(a,t)};var h=a.$element.dataTable(u);return s.length&&h.api().order(s),h},a.prototype.renderColTitleRow=function(){return{"<>":"tr",html:[e.map(this.props.columns,function(e){return{"<>":"th",text:e.title}})]}},a.prototype.getDataSource=function(){return{}},a.prototype.render=function(){return{"<>":"table",id:this.props.id,class:"display",cellspacing:0,width:"100%",html:[this.props.hasHeader?{"<>":"thead",html:[this.renderColTitleRow()]}:null,this.props.hasFooter?{"<>":"tfoot",html:[this.renderColTitleRow()]}:null]}},a}($);